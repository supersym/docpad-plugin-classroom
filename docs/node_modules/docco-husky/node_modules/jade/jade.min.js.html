<!DOCTYPE html><html><head><title>jade.min.js</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../../../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../../../../index.html" class="source"><span class="file_name">README</span></a><a href="../../../../.././test/a.js.html" class="source "><span class="base_path">. / test / </span><span class="file_name">a.js</span></a><a href="../../../../.././node_modules/docco-husky/lib/docco.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / lib / </span><span class="file_name">docco.js</span></a><a href="../../../../.././node_modules/docco-husky/test/Foo.java.html" class="source "><span class="base_path">. / node_modules / docco-husky / test / </span><span class="file_name">Foo.java</span></a><a href="../../../../.././node_modules/docco-husky/test/test.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / test / </span><span class="file_name">test.js</span></a><a href="../../../../.././node_modules/docco-husky/vendor/showdown.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / vendor / </span><span class="file_name">showdown.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/runtime.min.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / </span><span class="file_name">runtime.min.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/testing/index.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / testing / </span><span class="file_name">index.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/lib/lexer.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / lib / </span><span class="file_name">lexer.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/lib/doctypes.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / lib / </span><span class="file_name">doctypes.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/lib/jade.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / lib / </span><span class="file_name">jade.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/lib/nodes/doctype.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / lib / nodes / </span><span class="file_name">doctype.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/lib/nodes/code.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / lib / nodes / </span><span class="file_name">code.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/lib/nodes/case.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / lib / nodes / </span><span class="file_name">case.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/lib/nodes/index.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / lib / nodes / </span><span class="file_name">index.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/lib/nodes/block.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / lib / nodes / </span><span class="file_name">block.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/lib/nodes/text.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / lib / nodes / </span><span class="file_name">text.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/lib/nodes/tag.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / lib / nodes / </span><span class="file_name">tag.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/lib/nodes/filter.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / lib / nodes / </span><span class="file_name">filter.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/lib/nodes/block-comment.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / lib / nodes / </span><span class="file_name">block-comment.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/lib/nodes/each.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / lib / nodes / </span><span class="file_name">each.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/lib/nodes/mixin.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / lib / nodes / </span><span class="file_name">mixin.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/lib/nodes/literal.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / lib / nodes / </span><span class="file_name">literal.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/lib/nodes/node.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / lib / nodes / </span><span class="file_name">node.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/lib/nodes/comment.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / lib / nodes / </span><span class="file_name">comment.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/lib/parser.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / lib / </span><span class="file_name">parser.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/lib/compiler.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / lib / </span><span class="file_name">compiler.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/lib/utils.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / lib / </span><span class="file_name">utils.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/lib/runtime.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / lib / </span><span class="file_name">runtime.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/lib/inline-tags.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / lib / </span><span class="file_name">inline-tags.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/lib/filters.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / lib / </span><span class="file_name">filters.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/lib/self-closing.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / lib / </span><span class="file_name">self-closing.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/index.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / </span><span class="file_name">index.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/jade.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / </span><span class="file_name">jade.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/runtime.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / </span><span class="file_name">runtime.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/jade.min.js.html" class="source selected"><span class="base_path">. / node_modules / docco-husky / node_modules / jade / </span><span class="file_name">jade.min.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/node_modules/commander/lib/commander.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / node_modules / commander / lib / </span><span class="file_name">commander.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/node_modules/commander/index.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / node_modules / commander / </span><span class="file_name">index.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/node_modules/mkdirp/index.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / node_modules / mkdirp / </span><span class="file_name">index.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/node_modules/mkdirp/test/race.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / node_modules / mkdirp / test / </span><span class="file_name">race.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/node_modules/mkdirp/test/clobber.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / node_modules / mkdirp / test / </span><span class="file_name">clobber.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/node_modules/mkdirp/test/sync.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / node_modules / mkdirp / test / </span><span class="file_name">sync.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/node_modules/mkdirp/test/return_sync.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / node_modules / mkdirp / test / </span><span class="file_name">return_sync.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/node_modules/mkdirp/test/root.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / node_modules / mkdirp / test / </span><span class="file_name">root.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/node_modules/mkdirp/test/umask_sync.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / node_modules / mkdirp / test / </span><span class="file_name">umask_sync.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/node_modules/mkdirp/test/rel.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / node_modules / mkdirp / test / </span><span class="file_name">rel.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/node_modules/mkdirp/test/return.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / node_modules / mkdirp / test / </span><span class="file_name">return.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/node_modules/mkdirp/test/mkdirp.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / node_modules / mkdirp / test / </span><span class="file_name">mkdirp.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/node_modules/mkdirp/test/perm_sync.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / node_modules / mkdirp / test / </span><span class="file_name">perm_sync.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/node_modules/mkdirp/test/perm.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / node_modules / mkdirp / test / </span><span class="file_name">perm.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/node_modules/mkdirp/test/chmod.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / node_modules / mkdirp / test / </span><span class="file_name">chmod.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/node_modules/mkdirp/test/umask.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / node_modules / mkdirp / test / </span><span class="file_name">umask.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/jade/node_modules/mkdirp/examples/pow.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / jade / node_modules / mkdirp / examples / </span><span class="file_name">pow.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/walk/node-type-emitter.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / walk / </span><span class="file_name">node-type-emitter.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/walk/walk-async-only.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / walk / </span><span class="file_name">walk-async-only.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/walk/node_modules/forEachAsync/node_modules/sequence/sequence.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / walk / node_modules / forEachAsync / node_modules / sequence / </span><span class="file_name">sequence.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/walk/node_modules/forEachAsync/forEachAsync.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / walk / node_modules / forEachAsync / </span><span class="file_name">forEachAsync.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/walk/walk.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / walk / </span><span class="file_name">walk.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/gravatar/lib/gravatar.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / gravatar / lib / </span><span class="file_name">gravatar.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/gravatar/index.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / gravatar / </span><span class="file_name">index.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/gravatar/test/gravatar.test.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / gravatar / test / </span><span class="file_name">gravatar.test.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/dox/lib/utils.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / dox / lib / </span><span class="file_name">utils.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/dox/lib/dox.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / dox / lib / </span><span class="file_name">dox.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/dox/index.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / dox / </span><span class="file_name">index.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/dox/node_modules/commander/lib/commander.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / dox / node_modules / commander / lib / </span><span class="file_name">commander.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/dox/node_modules/commander/index.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / dox / node_modules / commander / </span><span class="file_name">index.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/dox/node_modules/github-flavored-markdown/scripts/showdown.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / dox / node_modules / github-flavored-markdown / scripts / </span><span class="file_name">showdown.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/dox/node_modules/github-flavored-markdown/scripts/preview.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / dox / node_modules / github-flavored-markdown / scripts / </span><span class="file_name">preview.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/dox/node_modules/github-flavored-markdown/code.rb.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / dox / node_modules / github-flavored-markdown / </span><span class="file_name">code.rb</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/coffee-script/lib/coffee-script/scope.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / coffee-script / lib / coffee-script / </span><span class="file_name">scope.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/coffee-script/lib/coffee-script/helpers.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / coffee-script / lib / coffee-script / </span><span class="file_name">helpers.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/coffee-script/lib/coffee-script/lexer.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / coffee-script / lib / coffee-script / </span><span class="file_name">lexer.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/coffee-script/lib/coffee-script/index.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / coffee-script / lib / coffee-script / </span><span class="file_name">index.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/coffee-script/lib/coffee-script/repl.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / coffee-script / lib / coffee-script / </span><span class="file_name">repl.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/coffee-script/lib/coffee-script/rewriter.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / coffee-script / lib / coffee-script / </span><span class="file_name">rewriter.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/coffee-script/lib/coffee-script/parser.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / coffee-script / lib / coffee-script / </span><span class="file_name">parser.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/coffee-script/lib/coffee-script/cake.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / coffee-script / lib / coffee-script / </span><span class="file_name">cake.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/coffee-script/lib/coffee-script/grammar.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / coffee-script / lib / coffee-script / </span><span class="file_name">grammar.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/coffee-script/lib/coffee-script/coffee-script.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / coffee-script / lib / coffee-script / </span><span class="file_name">coffee-script.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/coffee-script/lib/coffee-script/command.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / coffee-script / lib / coffee-script / </span><span class="file_name">command.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/coffee-script/lib/coffee-script/nodes.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / coffee-script / lib / coffee-script / </span><span class="file_name">nodes.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/coffee-script/lib/coffee-script/browser.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / coffee-script / lib / coffee-script / </span><span class="file_name">browser.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/coffee-script/lib/coffee-script/optparse.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / coffee-script / lib / coffee-script / </span><span class="file_name">optparse.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/underscore/index.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / underscore / </span><span class="file_name">index.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/underscore/underscore-min.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / underscore / </span><span class="file_name">underscore-min.js</span></a><a href="../../../../.././node_modules/docco-husky/node_modules/underscore/underscore.js.html" class="source "><span class="base_path">. / node_modules / docco-husky / node_modules / underscore / </span><span class="file_name">underscore.js</span></a><a href="../../../../.././node_modules/docco-husky/src/docco.coffee.html" class="source "><span class="base_path">. / node_modules / docco-husky / src / </span><span class="file_name">docco.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>jade.min.js</h1><div class="filepath">./node_modules/docco-husky/node_modules/jade/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div><p>CommonJS require()</p>
</td><td class="code"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">require</span><span class="p">(</span><span class="nx">p</span><span class="p">){</span><span class="kd">var</span> <span class="nx">path</span><span class="o">=</span><span class="nx">require</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">p</span><span class="p">),</span><span class="nx">mod</span><span class="o">=</span><span class="nx">require</span><span class="p">.</span><span class="nx">modules</span><span class="p">[</span><span class="nx">path</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">mod</span><span class="p">)</span><span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;failed to require &quot;&#39;</span><span class="o">+</span><span class="nx">p</span><span class="o">+</span><span class="s1">&#39;&quot;&#39;</span><span class="p">);</span><span class="k">return</span> <span class="nx">mod</span><span class="p">.</span><span class="nx">exports</span><span class="o">||</span><span class="p">(</span><span class="nx">mod</span><span class="p">.</span><span class="nx">exports</span><span class="o">=</span><span class="p">{},</span><span class="nx">mod</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">mod</span><span class="p">.</span><span class="nx">exports</span><span class="p">,</span><span class="nx">mod</span><span class="p">,</span><span class="nx">mod</span><span class="p">.</span><span class="nx">exports</span><span class="p">,</span><span class="nx">require</span><span class="p">.</span><span class="nx">relative</span><span class="p">(</span><span class="nx">path</span><span class="p">))),</span><span class="nx">mod</span><span class="p">.</span><span class="nx">exports</span><span class="p">}</span><span class="nx">require</span><span class="p">.</span><span class="nx">modules</span><span class="o">=</span><span class="p">{},</span><span class="nx">require</span><span class="p">.</span><span class="nx">resolve</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">path</span><span class="p">){</span><span class="kd">var</span> <span class="nx">orig</span><span class="o">=</span><span class="nx">path</span><span class="p">,</span><span class="nx">reg</span><span class="o">=</span><span class="nx">path</span><span class="o">+</span><span class="s2">&quot;.js&quot;</span><span class="p">,</span><span class="nx">index</span><span class="o">=</span><span class="nx">path</span><span class="o">+</span><span class="s2">&quot;/index.js&quot;</span><span class="p">;</span><span class="k">return</span> <span class="nx">require</span><span class="p">.</span><span class="nx">modules</span><span class="p">[</span><span class="nx">reg</span><span class="p">]</span><span class="o">&amp;&amp;</span><span class="nx">reg</span><span class="o">||</span><span class="nx">require</span><span class="p">.</span><span class="nx">modules</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span><span class="o">&amp;&amp;</span><span class="nx">index</span><span class="o">||</span><span class="nx">orig</span><span class="p">},</span><span class="nx">require</span><span class="p">.</span><span class="nx">register</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">fn</span><span class="p">){</span><span class="nx">require</span><span class="p">.</span><span class="nx">modules</span><span class="p">[</span><span class="nx">path</span><span class="p">]</span><span class="o">=</span><span class="nx">fn</span><span class="p">},</span><span class="nx">require</span><span class="p">.</span><span class="nx">relative</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">parent</span><span class="p">){</span><span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">p</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="o">!=</span><span class="nx">p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="k">return</span> <span class="nx">require</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span><span class="kd">var</span> <span class="nx">path</span><span class="o">=</span><span class="nx">parent</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">),</span><span class="nx">segs</span><span class="o">=</span><span class="nx">p</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">);</span><span class="nx">path</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">segs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span><span class="kd">var</span> <span class="nx">seg</span><span class="o">=</span><span class="nx">segs</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span><span class="s2">&quot;..&quot;</span><span class="o">==</span><span class="nx">seg</span><span class="o">?</span><span class="nx">path</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span><span class="o">:</span><span class="s2">&quot;.&quot;</span><span class="o">!=</span><span class="nx">seg</span><span class="o">&amp;&amp;</span><span class="nx">path</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">seg</span><span class="p">)}</span><span class="k">return</span> <span class="nx">require</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">))}},</span><span class="nx">require</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;compiler.js&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">,</span><span class="nx">require</span><span class="p">){</span><span class="kd">var</span> <span class="nx">nodes</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./nodes&quot;</span><span class="p">),</span><span class="nx">filters</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./filters&quot;</span><span class="p">),</span><span class="nx">doctypes</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./doctypes&quot;</span><span class="p">),</span><span class="nx">selfClosing</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./self-closing&quot;</span><span class="p">),</span><span class="nx">inlineTags</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./inline-tags&quot;</span><span class="p">),</span><span class="nx">utils</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./utils&quot;</span><span class="p">);</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="o">||</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">){</span><span class="kd">var</span> <span class="nx">arr</span><span class="o">=</span><span class="p">[];</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span><span class="nx">obj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="nx">arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span><span class="k">return</span> <span class="nx">arr</span><span class="p">}),</span><span class="nb">String</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">trimLeft</span><span class="o">||</span><span class="p">(</span><span class="nb">String</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">trimLeft</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\s+/</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)});</span><span class="kd">var</span> <span class="nx">Compiler</span><span class="o">=</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span><span class="nx">options</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="o">=</span><span class="nx">options</span><span class="o">=</span><span class="nx">options</span><span class="o">||</span><span class="p">{},</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="o">=</span><span class="nx">node</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">hasCompiledDoctype</span><span class="o">=!</span><span class="mi">1</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">hasCompiledTag</span><span class="o">=!</span><span class="mi">1</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">pp</span><span class="o">=</span><span class="nx">options</span><span class="p">.</span><span class="nx">pretty</span><span class="o">||!</span><span class="mi">1</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="o">=!</span><span class="mi">1</span><span class="o">!==</span><span class="nx">options</span><span class="p">.</span><span class="nx">compileDebug</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">indents</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">options</span><span class="p">.</span><span class="nx">doctype</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">setDoctype</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">doctype</span><span class="p">)};</span><span class="nx">Compiler</span><span class="p">.</span><span class="nx">prototype</span><span class="o">=</span><span class="p">{</span><span class="nx">compile</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;var interp;&quot;</span><span class="p">],</span><span class="k">this</span><span class="p">.</span><span class="nx">lastBufferedIdx</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">)},</span><span class="nx">setDoctype</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">){</span><span class="kd">var</span> <span class="nx">doctype</span><span class="o">=</span><span class="nx">doctypes</span><span class="p">[(</span><span class="nx">name</span><span class="o">||</span><span class="s2">&quot;default&quot;</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">()];</span><span class="nx">doctype</span><span class="o">=</span><span class="nx">doctype</span><span class="o">||</span><span class="s2">&quot;&lt;!DOCTYPE &quot;</span><span class="o">+</span><span class="nx">name</span><span class="o">+</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">doctype</span><span class="o">=</span><span class="nx">doctype</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">terse</span><span class="o">=</span><span class="s2">&quot;5&quot;</span><span class="o">==</span><span class="nx">name</span><span class="o">||</span><span class="s2">&quot;html&quot;</span><span class="o">==</span><span class="nx">name</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">xml</span><span class="o">=</span><span class="mi">0</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">doctype</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;&lt;?xml&quot;</span><span class="p">)},</span><span class="nx">buffer</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span><span class="nx">esc</span><span class="p">){</span><span class="nx">esc</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">str</span><span class="o">=</span><span class="nx">utils</span><span class="p">.</span><span class="nx">escape</span><span class="p">(</span><span class="nx">str</span><span class="p">)),</span><span class="k">this</span><span class="p">.</span><span class="nx">lastBufferedIdx</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">length</span><span class="o">?</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">lastBuffered</span><span class="o">+=</span><span class="nx">str</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">lastBufferedIdx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;buf.push(&#39;&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">lastBuffered</span><span class="o">+</span><span class="s2">&quot;&#39;);&quot;</span><span class="p">)</span><span class="o">:</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;buf.push(&#39;&quot;</span><span class="o">+</span><span class="nx">str</span><span class="o">+</span><span class="s2">&quot;&#39;);&quot;</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">lastBuffered</span><span class="o">=</span><span class="nx">str</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">lastBufferedIdx</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">length</span><span class="p">)},</span><span class="nx">visit</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">){</span><span class="kd">var</span> <span class="nx">debug</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">;</span><span class="nx">debug</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;__.unshift({ lineno: &quot;</span><span class="o">+</span><span class="nx">node</span><span class="p">.</span><span class="nx">line</span><span class="o">+</span><span class="s2">&quot;, filename: &quot;</span><span class="o">+</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">filename</span><span class="o">?</span><span class="s1">&#39;&quot;&#39;</span><span class="o">+</span><span class="nx">node</span><span class="p">.</span><span class="nx">filename</span><span class="o">+</span><span class="s1">&#39;&quot;&#39;</span><span class="o">:</span><span class="s2">&quot;__[0].filename&quot;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; });&quot;</span><span class="p">),</span><span class="o">!</span><span class="mi">1</span><span class="o">===</span><span class="nx">node</span><span class="p">.</span><span class="nx">debug</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">pop</span><span class="p">(),</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">pop</span><span class="p">()),</span><span class="k">this</span><span class="p">.</span><span class="nx">visitNode</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span><span class="nx">debug</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;__.shift();&quot;</span><span class="p">)},</span><span class="nx">visitNode</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">){</span><span class="kd">var</span> <span class="nx">name</span><span class="o">=</span><span class="nx">node</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">name</span><span class="o">||</span><span class="nx">node</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">match</span><span class="p">(</span><span class="sr">/function ([^(\s]+)()/</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span><span class="k">return</span> <span class="k">this</span><span class="p">[</span><span class="s2">&quot;visit&quot;</span><span class="o">+</span><span class="nx">name</span><span class="p">](</span><span class="nx">node</span><span class="p">)},</span><span class="nx">visitCase</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">){</span><span class="kd">var</span> <span class="nx">_</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">withinCase</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">withinCase</span><span class="o">=!</span><span class="mi">0</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;switch (&quot;</span><span class="o">+</span><span class="nx">node</span><span class="p">.</span><span class="nx">expr</span><span class="o">+</span><span class="s2">&quot;){&quot;</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">block</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">withinCase</span><span class="o">=</span><span class="nx">_</span><span class="p">},</span><span class="nx">visitWhen</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">){</span><span class="s2">&quot;default&quot;</span><span class="o">==</span><span class="nx">node</span><span class="p">.</span><span class="nx">expr</span><span class="o">?</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;default:&quot;</span><span class="p">)</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;case &quot;</span><span class="o">+</span><span class="nx">node</span><span class="p">.</span><span class="nx">expr</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">block</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;  break;&quot;</span><span class="p">)},</span><span class="nx">visitLiteral</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">){</span><span class="kd">var</span> <span class="nx">str</span><span class="o">=</span><span class="nx">node</span><span class="p">.</span><span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\n/g</span><span class="p">,</span><span class="s2">&quot;\\\\n&quot;</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">(</span><span class="nx">str</span><span class="p">)},</span><span class="nx">visitBlock</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">block</span><span class="p">){</span><span class="kd">var</span> <span class="nx">len</span><span class="o">=</span><span class="nx">block</span><span class="p">.</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">])},</span><span class="nx">visitDoctype</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">doctype</span><span class="p">){</span><span class="nx">doctype</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">doctype</span><span class="p">.</span><span class="nx">val</span><span class="o">||!</span><span class="k">this</span><span class="p">.</span><span class="nx">doctype</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">setDoctype</span><span class="p">(</span><span class="nx">doctype</span><span class="p">.</span><span class="nx">val</span><span class="o">||</span><span class="s2">&quot;default&quot;</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">doctype</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">doctype</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">hasCompiledDoctype</span><span class="o">=!</span><span class="mi">0</span><span class="p">},</span><span class="nx">visitMixin</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">mixin</span><span class="p">){</span><span class="kd">var</span> <span class="nx">name</span><span class="o">=</span><span class="nx">mixin</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/-/g</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;_mixin&quot;</span><span class="p">,</span><span class="nx">args</span><span class="o">=</span><span class="nx">mixin</span><span class="p">.</span><span class="nx">args</span><span class="o">||</span><span class="s2">&quot;&quot;</span><span class="p">;</span><span class="nx">mixin</span><span class="p">.</span><span class="nx">block</span><span class="o">?</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;var &quot;</span><span class="o">+</span><span class="nx">name</span><span class="o">+</span><span class="s2">&quot; = function(&quot;</span><span class="o">+</span><span class="nx">args</span><span class="o">+</span><span class="s2">&quot;){&quot;</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="nx">mixin</span><span class="p">.</span><span class="nx">block</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">))</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">name</span><span class="o">+</span><span class="s2">&quot;(&quot;</span><span class="o">+</span><span class="nx">args</span><span class="o">+</span><span class="s2">&quot;);&quot;</span><span class="p">)},</span><span class="nx">visitTag</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">tag</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">indents</span><span class="o">++</span><span class="p">;</span><span class="kd">var</span> <span class="nx">name</span><span class="o">=</span><span class="nx">tag</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">hasCompiledTag</span><span class="o">||</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">hasCompiledDoctype</span><span class="o">&amp;&amp;</span><span class="s2">&quot;html&quot;</span><span class="o">==</span><span class="nx">name</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">visitDoctype</span><span class="p">(),</span><span class="k">this</span><span class="p">.</span><span class="nx">hasCompiledTag</span><span class="o">=!</span><span class="mi">0</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">pp</span><span class="o">&amp;&amp;</span><span class="nx">inlineTags</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">(</span><span class="s2">&quot;\\n&quot;</span><span class="o">+</span><span class="nb">Array</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">indents</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">)),</span><span class="o">~</span><span class="nx">selfClosing</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="o">&amp;&amp;!</span><span class="k">this</span><span class="p">.</span><span class="nx">xml</span><span class="o">?</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="o">+</span><span class="nx">name</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">visitAttributes</span><span class="p">(</span><span class="nx">tag</span><span class="p">.</span><span class="nx">attrs</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">terse</span><span class="o">?</span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">(</span><span class="s2">&quot;/&gt;&quot;</span><span class="p">))</span><span class="o">:</span><span class="p">(</span><span class="nx">tag</span><span class="p">.</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">length</span><span class="o">?</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="o">+</span><span class="nx">name</span><span class="p">),</span><span class="nx">tag</span><span class="p">.</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">length</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">visitAttributes</span><span class="p">(</span><span class="nx">tag</span><span class="p">.</span><span class="nx">attrs</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">))</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="o">+</span><span class="nx">name</span><span class="o">+</span><span class="s2">&quot;&gt;&quot;</span><span class="p">),</span><span class="nx">tag</span><span class="p">.</span><span class="nx">code</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">visitCode</span><span class="p">(</span><span class="nx">tag</span><span class="p">.</span><span class="nx">code</span><span class="p">),</span><span class="nx">tag</span><span class="p">.</span><span class="nx">text</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">(</span><span class="nx">utils</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">tag</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">trimLeft</span><span class="p">())),</span><span class="k">this</span><span class="p">.</span><span class="nx">escape</span><span class="o">=</span><span class="s2">&quot;pre&quot;</span><span class="o">==</span><span class="nx">tag</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="nx">tag</span><span class="p">.</span><span class="nx">block</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">pp</span><span class="o">&amp;&amp;!~</span><span class="nx">inlineTags</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="o">&amp;&amp;!</span><span class="nx">tag</span><span class="p">.</span><span class="nx">textOnly</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">(</span><span class="s2">&quot;\\n&quot;</span><span class="o">+</span><span class="nb">Array</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">indents</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">)),</span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">(</span><span class="s2">&quot;&lt;/&quot;</span><span class="o">+</span><span class="nx">name</span><span class="o">+</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)),</span><span class="k">this</span><span class="p">.</span><span class="nx">indents</span><span class="o">--</span><span class="p">},</span><span class="nx">visitFilter</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">filter</span><span class="p">){</span><span class="kd">var</span> <span class="nx">fn</span><span class="o">=</span><span class="nx">filters</span><span class="p">[</span><span class="nx">filter</span><span class="p">.</span><span class="nx">name</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">fn</span><span class="p">)</span><span class="k">throw</span> <span class="nx">filter</span><span class="p">.</span><span class="nx">isASTFilter</span><span class="o">?</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;unknown ast filter &quot;&#39;</span><span class="o">+</span><span class="nx">filter</span><span class="p">.</span><span class="nx">name</span><span class="o">+</span><span class="s1">&#39;:&quot;&#39;</span><span class="p">)</span><span class="o">:</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;unknown filter &quot;:&#39;</span><span class="o">+</span><span class="nx">filter</span><span class="p">.</span><span class="nx">name</span><span class="o">+</span><span class="s1">&#39;&quot;&#39;</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">filter</span><span class="p">.</span><span class="nx">isASTFilter</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">fn</span><span class="p">(</span><span class="nx">filter</span><span class="p">.</span><span class="nx">block</span><span class="p">,</span><span class="k">this</span><span class="p">,</span><span class="nx">filter</span><span class="p">.</span><span class="nx">attrs</span><span class="p">));</span><span class="k">else</span><span class="p">{</span><span class="kd">var</span> <span class="nx">text</span><span class="o">=</span><span class="nx">filter</span><span class="p">.</span><span class="nx">block</span><span class="p">.</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">(</span><span class="nx">utils</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">fn</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="nx">filter</span><span class="p">.</span><span class="nx">attrs</span><span class="p">)))}},</span><span class="nx">visitText</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">text</span><span class="p">){</span><span class="nx">text</span><span class="o">=</span><span class="nx">utils</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">text</span><span class="p">.</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)),</span><span class="k">this</span><span class="p">.</span><span class="nx">escape</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">text</span><span class="o">=</span><span class="nx">escape</span><span class="p">(</span><span class="nx">text</span><span class="p">)),</span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">(</span><span class="nx">text</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">(</span><span class="s2">&quot;\\n&quot;</span><span class="p">)},</span><span class="nx">visitComment</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">comment</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">comment</span><span class="p">.</span><span class="nx">buffer</span><span class="p">)</span><span class="k">return</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">pp</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">(</span><span class="s2">&quot;\\n&quot;</span><span class="o">+</span><span class="nb">Array</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">indents</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">)),</span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">(</span><span class="s2">&quot;&lt;!--&quot;</span><span class="o">+</span><span class="nx">utils</span><span class="p">.</span><span class="nx">escape</span><span class="p">(</span><span class="nx">comment</span><span class="p">.</span><span class="nx">val</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;--&gt;&quot;</span><span class="p">)},</span><span class="nx">visitBlockComment</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">comment</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">comment</span><span class="p">.</span><span class="nx">buffer</span><span class="p">)</span><span class="k">return</span><span class="p">;</span><span class="mi">0</span><span class="o">==</span><span class="nx">comment</span><span class="p">.</span><span class="nx">val</span><span class="p">.</span><span class="nx">trim</span><span class="p">().</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;if&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">(</span><span class="s2">&quot;&lt;!--[&quot;</span><span class="o">+</span><span class="nx">comment</span><span class="p">.</span><span class="nx">val</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;]&gt;&quot;</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="nx">comment</span><span class="p">.</span><span class="nx">block</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">(</span><span class="s2">&quot;&lt;![endif]--&gt;&quot;</span><span class="p">))</span><span class="o">:</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">(</span><span class="s2">&quot;&lt;!--&quot;</span><span class="o">+</span><span class="nx">comment</span><span class="p">.</span><span class="nx">val</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="nx">comment</span><span class="p">.</span><span class="nx">block</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">(</span><span class="s2">&quot;--&gt;&quot;</span><span class="p">))},</span><span class="nx">visitCode</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">code</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">code</span><span class="p">.</span><span class="nx">buffer</span><span class="p">){</span><span class="kd">var</span> <span class="nx">val</span><span class="o">=</span><span class="nx">code</span><span class="p">.</span><span class="nx">val</span><span class="p">.</span><span class="nx">trimLeft</span><span class="p">();</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;var __val__ = &quot;</span><span class="o">+</span><span class="nx">val</span><span class="p">),</span><span class="nx">val</span><span class="o">=</span><span class="s1">&#39;null == __val__ ? &quot;&quot; : __val__&#39;</span><span class="p">,</span><span class="nx">code</span><span class="p">.</span><span class="nx">escape</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">val</span><span class="o">=</span><span class="s2">&quot;escape(&quot;</span><span class="o">+</span><span class="nx">val</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;buf.push(&quot;</span><span class="o">+</span><span class="nx">val</span><span class="o">+</span><span class="s2">&quot;);&quot;</span><span class="p">)}</span><span class="k">else</span> <span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">code</span><span class="p">.</span><span class="nx">val</span><span class="p">);</span><span class="nx">code</span><span class="p">.</span><span class="nx">block</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">code</span><span class="p">.</span><span class="nx">buffer</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="nx">code</span><span class="p">.</span><span class="nx">block</span><span class="p">),</span><span class="nx">code</span><span class="p">.</span><span class="nx">buffer</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">))},</span><span class="nx">visitEach</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">each</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;// iterate &quot;</span><span class="o">+</span><span class="nx">each</span><span class="p">.</span><span class="nx">obj</span><span class="o">+</span><span class="s2">&quot;\n&quot;</span><span class="o">+</span><span class="s2">&quot;(function(){\n&quot;</span><span class="o">+</span><span class="s2">&quot;  if (&#39;number&#39; == typeof &quot;</span><span class="o">+</span><span class="nx">each</span><span class="p">.</span><span class="nx">obj</span><span class="o">+</span><span class="s2">&quot;.length) {\n&quot;</span><span class="o">+</span><span class="s2">&quot;    for (var &quot;</span><span class="o">+</span><span class="nx">each</span><span class="p">.</span><span class="nx">key</span><span class="o">+</span><span class="s2">&quot; = 0, $$l = &quot;</span><span class="o">+</span><span class="nx">each</span><span class="p">.</span><span class="nx">obj</span><span class="o">+</span><span class="s2">&quot;.length; &quot;</span><span class="o">+</span><span class="nx">each</span><span class="p">.</span><span class="nx">key</span><span class="o">+</span><span class="s2">&quot; &lt; $$l; &quot;</span><span class="o">+</span><span class="nx">each</span><span class="p">.</span><span class="nx">key</span><span class="o">+</span><span class="s2">&quot;++) {\n&quot;</span><span class="o">+</span><span class="s2">&quot;      var &quot;</span><span class="o">+</span><span class="nx">each</span><span class="p">.</span><span class="nx">val</span><span class="o">+</span><span class="s2">&quot; = &quot;</span><span class="o">+</span><span class="nx">each</span><span class="p">.</span><span class="nx">obj</span><span class="o">+</span><span class="s2">&quot;[&quot;</span><span class="o">+</span><span class="nx">each</span><span class="p">.</span><span class="nx">key</span><span class="o">+</span><span class="s2">&quot;];\n&quot;</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="nx">each</span><span class="p">.</span><span class="nx">block</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;    }\n  } else {\n    for (var &quot;</span><span class="o">+</span><span class="nx">each</span><span class="p">.</span><span class="nx">key</span><span class="o">+</span><span class="s2">&quot; in &quot;</span><span class="o">+</span><span class="nx">each</span><span class="p">.</span><span class="nx">obj</span><span class="o">+</span><span class="s2">&quot;) {\n&quot;</span><span class="o">+</span><span class="s2">&quot;      if (&quot;</span><span class="o">+</span><span class="nx">each</span><span class="p">.</span><span class="nx">obj</span><span class="o">+</span><span class="s2">&quot;.hasOwnProperty(&quot;</span><span class="o">+</span><span class="nx">each</span><span class="p">.</span><span class="nx">key</span><span class="o">+</span><span class="s2">&quot;)){&quot;</span><span class="o">+</span><span class="s2">&quot;      var &quot;</span><span class="o">+</span><span class="nx">each</span><span class="p">.</span><span class="nx">val</span><span class="o">+</span><span class="s2">&quot; = &quot;</span><span class="o">+</span><span class="nx">each</span><span class="p">.</span><span class="nx">obj</span><span class="o">+</span><span class="s2">&quot;[&quot;</span><span class="o">+</span><span class="nx">each</span><span class="p">.</span><span class="nx">key</span><span class="o">+</span><span class="s2">&quot;];\n&quot;</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="nx">each</span><span class="p">.</span><span class="nx">block</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;      }\n&quot;</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;   }\n  }\n}).call(this);\n&quot;</span><span class="p">)},</span><span class="nx">visitAttributes</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">attrs</span><span class="p">){</span><span class="kd">var</span> <span class="nx">buf</span><span class="o">=</span><span class="p">[],</span><span class="nx">classes</span><span class="o">=</span><span class="p">[];</span><span class="k">this</span><span class="p">.</span><span class="nx">terse</span><span class="o">&amp;&amp;</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;terse: true&quot;</span><span class="p">),</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">attr</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">attr</span><span class="p">.</span><span class="nx">name</span><span class="o">==</span><span class="s2">&quot;class&quot;</span><span class="p">)</span><span class="nx">classes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="o">+</span><span class="nx">attr</span><span class="p">.</span><span class="nx">val</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">);</span><span class="k">else</span><span class="p">{</span><span class="kd">var</span> <span class="nx">pair</span><span class="o">=</span><span class="s2">&quot;&#39;&quot;</span><span class="o">+</span><span class="nx">attr</span><span class="p">.</span><span class="nx">name</span><span class="o">+</span><span class="s2">&quot;&#39;:(&quot;</span><span class="o">+</span><span class="nx">attr</span><span class="p">.</span><span class="nx">val</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">;</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">pair</span><span class="p">)}}),</span><span class="nx">classes</span><span class="p">.</span><span class="nx">length</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">classes</span><span class="o">=</span><span class="nx">classes</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot; + &#39; &#39; + &quot;</span><span class="p">),</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;class: &quot;</span><span class="o">+</span><span class="nx">classes</span><span class="p">)),</span><span class="nx">buf</span><span class="o">=</span><span class="nx">buf</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;class:&quot;</span><span class="p">,</span><span class="s1">&#39;&quot;class&quot;:&#39;</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;buf.push(attrs({ &quot;</span><span class="o">+</span><span class="nx">buf</span><span class="o">+</span><span class="s2">&quot; }));&quot;</span><span class="p">)}};</span><span class="kd">function</span> <span class="nx">escape</span><span class="p">(</span><span class="nx">html</span><span class="p">){</span><span class="k">return</span> <span class="nb">String</span><span class="p">(</span><span class="nx">html</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&amp;(?!\w+;)/g</span><span class="p">,</span><span class="s2">&quot;&amp;amp;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;/g</span><span class="p">,</span><span class="s2">&quot;&amp;lt;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&gt;/g</span><span class="p">,</span><span class="s2">&quot;&amp;gt;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&quot;/g</span><span class="p">,</span><span class="s2">&quot;&amp;quot;&quot;</span><span class="p">)}}),</span><span class="nx">require</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;doctypes.js&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">,</span><span class="nx">require</span><span class="p">){</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">=</span><span class="p">{</span><span class="mi">5</span><span class="o">:</span><span class="s2">&quot;&lt;!DOCTYPE html&gt;&quot;</span><span class="p">,</span><span class="nx">xml</span><span class="o">:</span><span class="s1">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;&#39;</span><span class="p">,</span><span class="s2">&quot;default&quot;</span><span class="o">:</span><span class="s1">&#39;&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;&#39;</span><span class="p">,</span><span class="nx">transitional</span><span class="o">:</span><span class="s1">&#39;&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;&#39;</span><span class="p">,</span><span class="nx">strict</span><span class="o">:</span><span class="s1">&#39;&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;&#39;</span><span class="p">,</span><span class="nx">frameset</span><span class="o">:</span><span class="s1">&#39;&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Frameset//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd&quot;&gt;&#39;</span><span class="p">,</span><span class="mf">1.1</span><span class="o">:</span><span class="s1">&#39;&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot; &quot;http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&quot;&gt;&#39;</span><span class="p">,</span><span class="nx">basic</span><span class="o">:</span><span class="s1">&#39;&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML Basic 1.1//EN&quot; &quot;http://www.w3.org/TR/xhtml-basic/xhtml-basic11.dtd&quot;&gt;&#39;</span><span class="p">,</span><span class="nx">mobile</span><span class="o">:</span><span class="s1">&#39;&lt;!DOCTYPE html PUBLIC &quot;-//WAPFORUM//DTD XHTML Mobile 1.2//EN&quot; &quot;http://www.openmobilealliance.org/tech/DTD/xhtml-mobile12.dtd&quot;&gt;&#39;</span><span class="p">}}),</span><span class="nx">require</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;filters.js&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">,</span><span class="nx">require</span><span class="p">){</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">=</span><span class="p">{</span><span class="nx">cdata</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">){</span><span class="k">return</span><span class="s2">&quot;&lt;![CDATA[\\n&quot;</span><span class="o">+</span><span class="nx">str</span><span class="o">+</span><span class="s2">&quot;\\n]]&gt;&quot;</span><span class="p">},</span><span class="nx">sass</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">){</span><span class="nx">str</span><span class="o">=</span><span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\\n/g</span><span class="p">,</span><span class="s2">&quot;\n&quot;</span><span class="p">);</span><span class="kd">var</span> <span class="nx">sass</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;sass&quot;</span><span class="p">).</span><span class="nx">render</span><span class="p">(</span><span class="nx">str</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\n/g</span><span class="p">,</span><span class="s2">&quot;\\n&quot;</span><span class="p">);</span><span class="k">return</span><span class="s1">&#39;&lt;style type=&quot;text/css&quot;&gt;&#39;</span><span class="o">+</span><span class="nx">sass</span><span class="o">+</span><span class="s2">&quot;&lt;/style&gt;&quot;</span><span class="p">},</span><span class="nx">stylus</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span><span class="nx">options</span><span class="p">){</span><span class="kd">var</span> <span class="nx">ret</span><span class="p">;</span><span class="nx">str</span><span class="o">=</span><span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\\n/g</span><span class="p">,</span><span class="s2">&quot;\n&quot;</span><span class="p">);</span><span class="kd">var</span> <span class="nx">stylus</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;stylus&quot;</span><span class="p">);</span><span class="k">return</span> <span class="nx">stylus</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span><span class="nx">options</span><span class="p">).</span><span class="nx">render</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">css</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="k">throw</span> <span class="nx">err</span><span class="p">;</span><span class="nx">ret</span><span class="o">=</span><span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\n/g</span><span class="p">,</span><span class="s2">&quot;\\n&quot;</span><span class="p">)}),</span><span class="s1">&#39;&lt;style type=&quot;text/css&quot;&gt;&#39;</span><span class="o">+</span><span class="nx">ret</span><span class="o">+</span><span class="s2">&quot;&lt;/style&gt;&quot;</span><span class="p">},</span><span class="nx">less</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">){</span><span class="kd">var</span> <span class="nx">ret</span><span class="p">;</span><span class="k">return</span> <span class="nx">str</span><span class="o">=</span><span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\\n/g</span><span class="p">,</span><span class="s2">&quot;\n&quot;</span><span class="p">),</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;less&quot;</span><span class="p">).</span><span class="nx">render</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">css</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="k">throw</span> <span class="nx">err</span><span class="p">;</span><span class="nx">ret</span><span class="o">=</span><span class="s1">&#39;&lt;style type=&quot;text/css&quot;&gt;&#39;</span><span class="o">+</span><span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\n/g</span><span class="p">,</span><span class="s2">&quot;\\n&quot;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&lt;/style&gt;&quot;</span><span class="p">}),</span><span class="nx">ret</span><span class="p">},</span><span class="nx">markdown</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">){</span><span class="kd">var</span> <span class="nx">md</span><span class="p">;</span><span class="k">try</span><span class="p">{</span><span class="nx">md</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;markdown&quot;</span><span class="p">)}</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span><span class="k">try</span><span class="p">{</span><span class="nx">md</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;discount&quot;</span><span class="p">)}</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span><span class="k">try</span><span class="p">{</span><span class="nx">md</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;markdown-js&quot;</span><span class="p">)}</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span><span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Cannot find markdown library, install markdown or discount&quot;</span><span class="p">)}}}</span><span class="k">return</span> <span class="nx">str</span><span class="o">=</span><span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\\n/g</span><span class="p">,</span><span class="s2">&quot;\n&quot;</span><span class="p">),</span><span class="nx">md</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">str</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\n/g</span><span class="p">,</span><span class="s2">&quot;\\n&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&#39;/g</span><span class="p">,</span><span class="s2">&quot;&amp;#39;&quot;</span><span class="p">)},</span><span class="nx">coffeescript</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">){</span><span class="nx">str</span><span class="o">=</span><span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\\n/g</span><span class="p">,</span><span class="s2">&quot;\n&quot;</span><span class="p">);</span><span class="kd">var</span> <span class="nx">js</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;coffee-script&quot;</span><span class="p">).</span><span class="nx">compile</span><span class="p">(</span><span class="nx">str</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\n/g</span><span class="p">,</span><span class="s2">&quot;\\n&quot;</span><span class="p">);</span><span class="k">return</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot;&gt;\\n&#39;</span><span class="o">+</span><span class="nx">js</span><span class="o">+</span><span class="s2">&quot;&lt;/script&gt;&quot;</span><span class="p">}}}),</span><span class="nx">require</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;inline-tags.js&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">,</span><span class="nx">require</span><span class="p">){</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="s2">&quot;abbr&quot;</span><span class="p">,</span><span class="s2">&quot;acronym&quot;</span><span class="p">,</span><span class="s2">&quot;b&quot;</span><span class="p">,</span><span class="s2">&quot;br&quot;</span><span class="p">,</span><span class="s2">&quot;code&quot;</span><span class="p">,</span><span class="s2">&quot;em&quot;</span><span class="p">,</span><span class="s2">&quot;font&quot;</span><span class="p">,</span><span class="s2">&quot;i&quot;</span><span class="p">,</span><span class="s2">&quot;img&quot;</span><span class="p">,</span><span class="s2">&quot;ins&quot;</span><span class="p">,</span><span class="s2">&quot;kbd&quot;</span><span class="p">,</span><span class="s2">&quot;map&quot;</span><span class="p">,</span><span class="s2">&quot;samp&quot;</span><span class="p">,</span><span class="s2">&quot;small&quot;</span><span class="p">,</span><span class="s2">&quot;span&quot;</span><span class="p">,</span><span class="s2">&quot;strong&quot;</span><span class="p">,</span><span class="s2">&quot;sub&quot;</span><span class="p">,</span><span class="s2">&quot;sup&quot;</span><span class="p">]}),</span><span class="nx">require</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;jade.js&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">,</span><span class="nx">require</span><span class="p">){</span><span class="kd">var</span> <span class="nx">Parser</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./parser&quot;</span><span class="p">),</span><span class="nx">Lexer</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./lexer&quot;</span><span class="p">),</span><span class="nx">Compiler</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./compiler&quot;</span><span class="p">),</span><span class="nx">runtime</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./runtime&quot;</span><span class="p">);</span><span class="nx">exports</span><span class="p">.</span><span class="nx">version</span><span class="o">=</span><span class="s2">&quot;0.17.0&quot;</span><span class="p">,</span><span class="nx">exports</span><span class="p">.</span><span class="nx">selfClosing</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./self-closing&quot;</span><span class="p">),</span><span class="nx">exports</span><span class="p">.</span><span class="nx">doctypes</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./doctypes&quot;</span><span class="p">),</span><span class="nx">exports</span><span class="p">.</span><span class="nx">filters</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./filters&quot;</span><span class="p">),</span><span class="nx">exports</span><span class="p">.</span><span class="nx">utils</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./utils&quot;</span><span class="p">),</span><span class="nx">exports</span><span class="p">.</span><span class="nx">Compiler</span><span class="o">=</span><span class="nx">Compiler</span><span class="p">,</span><span class="nx">exports</span><span class="p">.</span><span class="nx">Parser</span><span class="o">=</span><span class="nx">Parser</span><span class="p">,</span><span class="nx">exports</span><span class="p">.</span><span class="nx">Lexer</span><span class="o">=</span><span class="nx">Lexer</span><span class="p">,</span><span class="nx">exports</span><span class="p">.</span><span class="nx">nodes</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./nodes&quot;</span><span class="p">),</span><span class="nx">exports</span><span class="p">.</span><span class="nx">runtime</span><span class="o">=</span><span class="nx">runtime</span><span class="p">,</span><span class="nx">exports</span><span class="p">.</span><span class="nx">cache</span><span class="o">=</span><span class="p">{};</span><span class="kd">function</span> <span class="nx">parse</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span><span class="nx">options</span><span class="p">){</span><span class="k">try</span><span class="p">{</span><span class="kd">var</span> <span class="nx">parser</span><span class="o">=</span><span class="k">new</span> <span class="nx">Parser</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span><span class="nx">options</span><span class="p">.</span><span class="nx">filename</span><span class="p">,</span><span class="nx">options</span><span class="p">),</span><span class="nx">compiler</span><span class="o">=</span><span class="k">new</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">compiler</span><span class="o">||</span><span class="nx">Compiler</span><span class="p">)(</span><span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(),</span><span class="nx">options</span><span class="p">),</span><span class="nx">js</span><span class="o">=</span><span class="nx">compiler</span><span class="p">.</span><span class="nx">compile</span><span class="p">();</span><span class="k">return</span> <span class="nx">options</span><span class="p">.</span><span class="nx">debug</span><span class="o">&amp;&amp;</span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;\nCompiled Function:\n\n[90m%s[0m&quot;</span><span class="p">,</span><span class="nx">js</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^/gm</span><span class="p">,</span><span class="s2">&quot;  &quot;</span><span class="p">)),</span><span class="s2">&quot;var buf = [];\n&quot;</span><span class="o">+</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">self</span><span class="o">?</span><span class="s2">&quot;var self = locals || {};\n&quot;</span><span class="o">+</span><span class="nx">js</span><span class="o">:</span><span class="s2">&quot;with (locals || {}) {\n&quot;</span><span class="o">+</span><span class="nx">js</span><span class="o">+</span><span class="s2">&quot;\n}\n&quot;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;return buf.join(&quot;&quot;);&#39;</span><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span><span class="nx">parser</span><span class="o">=</span><span class="nx">parser</span><span class="p">.</span><span class="nx">context</span><span class="p">(),</span><span class="nx">runtime</span><span class="p">.</span><span class="nx">rethrow</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">parser</span><span class="p">.</span><span class="nx">filename</span><span class="p">,</span><span class="nx">parser</span><span class="p">.</span><span class="nx">lexer</span><span class="p">.</span><span class="nx">lineno</span><span class="p">)}}</span><span class="nx">exports</span><span class="p">.</span><span class="nx">compile</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span><span class="nx">options</span><span class="p">){</span><span class="kd">var</span> <span class="nx">options</span><span class="o">=</span><span class="nx">options</span><span class="o">||</span><span class="p">{},</span><span class="nx">client</span><span class="o">=</span><span class="nx">options</span><span class="p">.</span><span class="nx">client</span><span class="p">,</span><span class="nx">filename</span><span class="o">=</span><span class="nx">options</span><span class="p">.</span><span class="nx">filename</span><span class="o">?</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">filename</span><span class="p">)</span><span class="o">:</span><span class="s2">&quot;undefined&quot;</span><span class="p">,</span><span class="nx">fn</span><span class="p">;</span><span class="k">return</span> <span class="nx">options</span><span class="p">.</span><span class="nx">compileDebug</span><span class="o">!==!</span><span class="mi">1</span><span class="o">?</span><span class="nx">fn</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;var __ = [{ lineno: 1, filename: &quot;</span><span class="o">+</span><span class="nx">filename</span><span class="o">+</span><span class="s2">&quot; }];&quot;</span><span class="p">,</span><span class="s2">&quot;try {&quot;</span><span class="p">,</span><span class="nx">parse</span><span class="p">(</span><span class="nb">String</span><span class="p">(</span><span class="nx">str</span><span class="p">),</span><span class="nx">options</span><span class="o">||</span><span class="p">{}),</span><span class="s2">&quot;} catch (err) {&quot;</span><span class="p">,</span><span class="s2">&quot;  rethrow(err, __[0].filename, __[0].lineno);&quot;</span><span class="p">,</span><span class="s2">&quot;}&quot;</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">)</span><span class="o">:</span><span class="nx">fn</span><span class="o">=</span><span class="nx">parse</span><span class="p">(</span><span class="nb">String</span><span class="p">(</span><span class="nx">str</span><span class="p">),</span><span class="nx">options</span><span class="o">||</span><span class="p">{}),</span><span class="nx">client</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">fn</span><span class="o">=</span><span class="s2">&quot;var attrs = jade.attrs, escape = jade.escape, rethrow = jade.rethrow;\n&quot;</span><span class="o">+</span><span class="nx">fn</span><span class="p">),</span><span class="nx">fn</span><span class="o">=</span><span class="k">new</span> <span class="nb">Function</span><span class="p">(</span><span class="s2">&quot;locals, attrs, escape, rethrow&quot;</span><span class="p">,</span><span class="nx">fn</span><span class="p">),</span><span class="nx">client</span><span class="o">?</span><span class="nx">fn</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">locals</span><span class="p">){</span><span class="k">return</span> <span class="nx">fn</span><span class="p">(</span><span class="nx">locals</span><span class="p">,</span><span class="nx">runtime</span><span class="p">.</span><span class="nx">attrs</span><span class="p">,</span><span class="nx">runtime</span><span class="p">.</span><span class="nx">escape</span><span class="p">,</span><span class="nx">runtime</span><span class="p">.</span><span class="nx">rethrow</span><span class="p">)}},</span><span class="nx">exports</span><span class="p">.</span><span class="nx">render</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span><span class="nx">options</span><span class="p">,</span><span class="nx">fn</span><span class="p">){</span><span class="s2">&quot;function&quot;</span><span class="o">==</span><span class="k">typeof</span> <span class="nx">options</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">fn</span><span class="o">=</span><span class="nx">options</span><span class="p">,</span><span class="nx">options</span><span class="o">=</span><span class="p">{});</span><span class="k">if</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">cache</span><span class="o">&amp;&amp;!</span><span class="nx">options</span><span class="p">.</span><span class="nx">filename</span><span class="p">)</span><span class="k">return</span> <span class="nx">fn</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;the &quot;filename&quot; option is required for caching&#39;</span><span class="p">));</span><span class="k">try</span><span class="p">{</span><span class="kd">var</span> <span class="nx">path</span><span class="o">=</span><span class="nx">options</span><span class="p">.</span><span class="nx">filename</span><span class="p">,</span><span class="nx">tmpl</span><span class="o">=</span><span class="nx">options</span><span class="p">.</span><span class="nx">cache</span><span class="o">?</span><span class="nx">exports</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">path</span><span class="p">]</span><span class="o">||</span><span class="p">(</span><span class="nx">exports</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">path</span><span class="p">]</span><span class="o">=</span><span class="nx">exports</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span><span class="nx">options</span><span class="p">))</span><span class="o">:</span><span class="nx">exports</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span><span class="nx">fn</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="nx">tmpl</span><span class="p">(</span><span class="nx">options</span><span class="p">))}</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span><span class="nx">fn</span><span class="p">(</span><span class="nx">err</span><span class="p">)}},</span><span class="nx">exports</span><span class="p">.</span><span class="nx">renderFile</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">options</span><span class="p">,</span><span class="nx">fn</span><span class="p">){</span><span class="kd">var</span> <span class="nx">key</span><span class="o">=</span><span class="nx">path</span><span class="o">+</span><span class="s2">&quot;:string&quot;</span><span class="p">;</span><span class="s2">&quot;function&quot;</span><span class="o">==</span><span class="k">typeof</span> <span class="nx">options</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">fn</span><span class="o">=</span><span class="nx">options</span><span class="p">,</span><span class="nx">options</span><span class="o">=</span><span class="p">{}),</span><span class="nx">options</span><span class="p">.</span><span class="nx">filename</span><span class="o">=</span><span class="nx">path</span><span class="p">;</span><span class="kd">var</span> <span class="nx">str</span><span class="o">=</span><span class="nx">options</span><span class="p">.</span><span class="nx">cache</span><span class="o">?</span><span class="nx">exports</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="o">||</span><span class="p">(</span><span class="nx">exports</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="o">=</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="s2">&quot;utf8&quot;</span><span class="p">))</span><span class="o">:</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="s2">&quot;utf8&quot;</span><span class="p">);</span><span class="nx">exports</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span><span class="nx">options</span><span class="p">,</span><span class="nx">fn</span><span class="p">)},</span><span class="nx">exports</span><span class="p">.</span><span class="nx">__express</span><span class="o">=</span><span class="nx">exports</span><span class="p">.</span><span class="nx">renderFile</span><span class="p">}),</span><span class="nx">require</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;lexer.js&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">,</span><span class="nx">require</span><span class="p">){</span><span class="kd">var</span> <span class="nx">Lexer</span><span class="o">=</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span><span class="nx">options</span><span class="p">){</span><span class="nx">options</span><span class="o">=</span><span class="nx">options</span><span class="o">||</span><span class="p">{},</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="o">=</span><span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\r\n|\r/g</span><span class="p">,</span><span class="s2">&quot;\n&quot;</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">colons</span><span class="o">=</span><span class="nx">options</span><span class="p">.</span><span class="nx">colons</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">deferredTokens</span><span class="o">=</span><span class="p">[],</span><span class="k">this</span><span class="p">.</span><span class="nx">lastIndents</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">lineno</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">stash</span><span class="o">=</span><span class="p">[],</span><span class="k">this</span><span class="p">.</span><span class="nx">indentStack</span><span class="o">=</span><span class="p">[],</span><span class="k">this</span><span class="p">.</span><span class="nx">indentRe</span><span class="o">=</span><span class="kc">null</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">pipeless</span><span class="o">=!</span><span class="mi">1</span><span class="p">};</span><span class="nx">Lexer</span><span class="p">.</span><span class="nx">prototype</span><span class="o">=</span><span class="p">{</span><span class="nx">tok</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span><span class="nx">val</span><span class="p">){</span><span class="k">return</span><span class="p">{</span><span class="nx">type</span><span class="o">:</span><span class="nx">type</span><span class="p">,</span><span class="nx">line</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">lineno</span><span class="p">,</span><span class="nx">val</span><span class="o">:</span><span class="nx">val</span><span class="p">}},</span><span class="nx">consume</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">len</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">len</span><span class="p">)},</span><span class="nx">scan</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">regexp</span><span class="p">,</span><span class="nx">type</span><span class="p">){</span><span class="kd">var</span> <span class="nx">captures</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">captures</span><span class="o">=</span><span class="nx">regexp</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">))</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">consume</span><span class="p">(</span><span class="nx">captures</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">tok</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span><span class="nx">captures</span><span class="p">[</span><span class="mi">1</span><span class="p">])},</span><span class="nx">defer</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">tok</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">deferredTokens</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">tok</span><span class="p">)},</span><span class="nx">lookahead</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">){</span><span class="kd">var</span> <span class="nx">fetch</span><span class="o">=</span><span class="nx">n</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">stash</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="k">while</span><span class="p">(</span><span class="nx">fetch</span><span class="o">--&gt;</span><span class="mi">0</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">stash</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">next</span><span class="p">());</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">stash</span><span class="p">[</span><span class="o">--</span><span class="nx">n</span><span class="p">]},</span><span class="nx">indexOfDelimiters</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span><span class="nx">end</span><span class="p">){</span><span class="kd">var</span> <span class="nx">str</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">,</span><span class="nx">nstart</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">nend</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">pos</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">len</span><span class="o">=</span><span class="nx">str</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="k">if</span><span class="p">(</span><span class="nx">start</span><span class="o">==</span><span class="nx">str</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span><span class="o">++</span><span class="nx">nstart</span><span class="p">;</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">end</span><span class="o">==</span><span class="nx">str</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">&amp;&amp;++</span><span class="nx">nend</span><span class="o">==</span><span class="nx">nstart</span><span class="p">){</span><span class="nx">pos</span><span class="o">=</span><span class="nx">i</span><span class="p">;</span><span class="k">break</span><span class="p">}</span><span class="k">return</span> <span class="nx">pos</span><span class="p">},</span><span class="nx">stashed</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">stash</span><span class="p">.</span><span class="nx">length</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">stash</span><span class="p">.</span><span class="nx">shift</span><span class="p">()},</span><span class="nx">deferred</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">deferredTokens</span><span class="p">.</span><span class="nx">length</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">deferredTokens</span><span class="p">.</span><span class="nx">shift</span><span class="p">()},</span><span class="nx">eos</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="k">return</span><span class="p">;</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">indentStack</span><span class="p">.</span><span class="nx">length</span><span class="o">?</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">indentStack</span><span class="p">.</span><span class="nx">shift</span><span class="p">(),</span><span class="k">this</span><span class="p">.</span><span class="nx">tok</span><span class="p">(</span><span class="s2">&quot;outdent&quot;</span><span class="p">))</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">tok</span><span class="p">(</span><span class="s2">&quot;eos&quot;</span><span class="p">)},</span><span class="nx">comment</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">captures</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">captures</span><span class="o">=</span><span class="sr">/^ *\/\/(-)?([^\n]*)/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">)){</span><span class="k">this</span><span class="p">.</span><span class="nx">consume</span><span class="p">(</span><span class="nx">captures</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="p">);</span><span class="kd">var</span> <span class="nx">tok</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">tok</span><span class="p">(</span><span class="s2">&quot;comment&quot;</span><span class="p">,</span><span class="nx">captures</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span><span class="k">return</span> <span class="nx">tok</span><span class="p">.</span><span class="nx">buffer</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="o">!=</span><span class="nx">captures</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nx">tok</span><span class="p">}},</span><span class="nx">tag</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">captures</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">captures</span><span class="o">=</span><span class="sr">/^(\w[-:\w]*)/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">)){</span><span class="k">this</span><span class="p">.</span><span class="nx">consume</span><span class="p">(</span><span class="nx">captures</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="p">);</span><span class="kd">var</span> <span class="nx">tok</span><span class="p">,</span><span class="nx">name</span><span class="o">=</span><span class="nx">captures</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="o">==</span><span class="nx">name</span><span class="p">[</span><span class="nx">name</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]){</span><span class="nx">name</span><span class="o">=</span><span class="nx">name</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="nx">tok</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">tok</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">,</span><span class="nx">name</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">defer</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tok</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">));</span><span class="k">while</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">)}</span><span class="k">else</span> <span class="nx">tok</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">tok</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">,</span><span class="nx">name</span><span class="p">);</span><span class="k">return</span> <span class="nx">tok</span><span class="p">}},</span><span class="nx">filter</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">scan</span><span class="p">(</span><span class="sr">/^:(\w+)/</span><span class="p">,</span><span class="s2">&quot;filter&quot;</span><span class="p">)},</span><span class="nx">doctype</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">scan</span><span class="p">(</span><span class="sr">/^(?:!!!|doctype) *([^\n]+)?/</span><span class="p">,</span><span class="s2">&quot;doctype&quot;</span><span class="p">)},</span><span class="nx">id</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">scan</span><span class="p">(</span><span class="sr">/^#([\w-]+)/</span><span class="p">,</span><span class="s2">&quot;id&quot;</span><span class="p">)},</span><span class="nx">className</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">scan</span><span class="p">(</span><span class="sr">/^\.([\w-]+)/</span><span class="p">,</span><span class="s2">&quot;class&quot;</span><span class="p">)},</span><span class="nx">text</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">scan</span><span class="p">(</span><span class="sr">/^(?:\| ?)?([^\n]+)/</span><span class="p">,</span><span class="s2">&quot;text&quot;</span><span class="p">)},</span><span class="s2">&quot;extends&quot;</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">scan</span><span class="p">(</span><span class="sr">/^extends +([^\n]+)/</span><span class="p">,</span><span class="s2">&quot;extends&quot;</span><span class="p">)},</span><span class="nx">block</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">scan</span><span class="p">(</span><span class="sr">/^block +([^\n]+)/</span><span class="p">,</span><span class="s2">&quot;block&quot;</span><span class="p">)},</span><span class="nx">include</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">scan</span><span class="p">(</span><span class="sr">/^include +([^\n]+)/</span><span class="p">,</span><span class="s2">&quot;include&quot;</span><span class="p">)},</span><span class="s2">&quot;case&quot;</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">scan</span><span class="p">(</span><span class="sr">/^case +([^\n]+)/</span><span class="p">,</span><span class="s2">&quot;case&quot;</span><span class="p">)},</span><span class="nx">when</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">scan</span><span class="p">(</span><span class="sr">/^when +([^:\n]+)/</span><span class="p">,</span><span class="s2">&quot;when&quot;</span><span class="p">)},</span><span class="s2">&quot;default&quot;</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">scan</span><span class="p">(</span><span class="sr">/^default */</span><span class="p">,</span><span class="s2">&quot;default&quot;</span><span class="p">)},</span><span class="nx">assignment</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">captures</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">captures</span><span class="o">=</span><span class="sr">/^(\w+) += *([^;\n]+)( *;? *)/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">)){</span><span class="k">this</span><span class="p">.</span><span class="nx">consume</span><span class="p">(</span><span class="nx">captures</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="p">);</span><span class="kd">var</span> <span class="nx">name</span><span class="o">=</span><span class="nx">captures</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nx">val</span><span class="o">=</span><span class="nx">captures</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">tok</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span><span class="s2">&quot;var &quot;</span><span class="o">+</span><span class="nx">name</span><span class="o">+</span><span class="s2">&quot; = (&quot;</span><span class="o">+</span><span class="nx">val</span><span class="o">+</span><span class="s2">&quot;);&quot;</span><span class="p">)}},</span><span class="nx">mixin</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">captures</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">captures</span><span class="o">=</span><span class="sr">/^mixin +([-\w]+)(?:\((.*)\))?/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">)){</span><span class="k">this</span><span class="p">.</span><span class="nx">consume</span><span class="p">(</span><span class="nx">captures</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="p">);</span><span class="kd">var</span> <span class="nx">tok</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">tok</span><span class="p">(</span><span class="s2">&quot;mixin&quot;</span><span class="p">,</span><span class="nx">captures</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span><span class="k">return</span> <span class="nx">tok</span><span class="p">.</span><span class="nx">args</span><span class="o">=</span><span class="nx">captures</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="nx">tok</span><span class="p">}},</span><span class="nx">conditional</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">captures</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">captures</span><span class="o">=</span><span class="sr">/^(if|unless|else if|else)\b([^\n]*)/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">)){</span><span class="k">this</span><span class="p">.</span><span class="nx">consume</span><span class="p">(</span><span class="nx">captures</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="p">);</span><span class="kd">var</span> <span class="nx">type</span><span class="o">=</span><span class="nx">captures</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nx">js</span><span class="o">=</span><span class="nx">captures</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="k">switch</span><span class="p">(</span><span class="nx">type</span><span class="p">){</span><span class="k">case</span><span class="s2">&quot;if&quot;</span><span class="o">:</span><span class="nx">js</span><span class="o">=</span><span class="s2">&quot;if (&quot;</span><span class="o">+</span><span class="nx">js</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">;</span><span class="k">break</span><span class="p">;</span><span class="k">case</span><span class="s2">&quot;unless&quot;</span><span class="o">:</span><span class="nx">js</span><span class="o">=</span><span class="s2">&quot;if (!(&quot;</span><span class="o">+</span><span class="nx">js</span><span class="o">+</span><span class="s2">&quot;))&quot;</span><span class="p">;</span><span class="k">break</span><span class="p">;</span><span class="k">case</span><span class="s2">&quot;else if&quot;</span><span class="o">:</span><span class="nx">js</span><span class="o">=</span><span class="s2">&quot;else if (&quot;</span><span class="o">+</span><span class="nx">js</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">;</span><span class="k">break</span><span class="p">;</span><span class="k">case</span><span class="s2">&quot;else&quot;</span><span class="o">:</span><span class="nx">js</span><span class="o">=</span><span class="s2">&quot;else&quot;</span><span class="p">}</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">tok</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span><span class="nx">js</span><span class="p">)}},</span><span class="s2">&quot;while&quot;</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">captures</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">captures</span><span class="o">=</span><span class="sr">/^while +([^\n]+)/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">))</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">consume</span><span class="p">(</span><span class="nx">captures</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">tok</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span><span class="s2">&quot;while (&quot;</span><span class="o">+</span><span class="nx">captures</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)},</span><span class="nx">each</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">captures</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">captures</span><span class="o">=</span><span class="sr">/^(?:- *)?(?:each|for) +(\w+)(?: *, *(\w+))? * in *([^\n]+)/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">)){</span><span class="k">this</span><span class="p">.</span><span class="nx">consume</span><span class="p">(</span><span class="nx">captures</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="p">);</span><span class="kd">var</span> <span class="nx">tok</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">tok</span><span class="p">(</span><span class="s2">&quot;each&quot;</span><span class="p">,</span><span class="nx">captures</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span><span class="k">return</span> <span class="nx">tok</span><span class="p">.</span><span class="nx">key</span><span class="o">=</span><span class="nx">captures</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">||</span><span class="s2">&quot;$index&quot;</span><span class="p">,</span><span class="nx">tok</span><span class="p">.</span><span class="nx">code</span><span class="o">=</span><span class="nx">captures</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="nx">tok</span><span class="p">}},</span><span class="nx">code</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">captures</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">captures</span><span class="o">=</span><span class="sr">/^(!?=|-)([^\n]+)/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">)){</span><span class="k">this</span><span class="p">.</span><span class="nx">consume</span><span class="p">(</span><span class="nx">captures</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="p">);</span><span class="kd">var</span> <span class="nx">flags</span><span class="o">=</span><span class="nx">captures</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="nx">captures</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="nx">captures</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="kd">var</span> <span class="nx">tok</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">tok</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span><span class="nx">captures</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span><span class="k">return</span> <span class="nx">tok</span><span class="p">.</span><span class="nx">escape</span><span class="o">=</span><span class="nx">flags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">===</span><span class="s2">&quot;=&quot;</span><span class="p">,</span><span class="nx">tok</span><span class="p">.</span><span class="nx">buffer</span><span class="o">=</span><span class="nx">flags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">===</span><span class="s2">&quot;=&quot;</span><span class="o">||</span><span class="nx">flags</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">===</span><span class="s2">&quot;=&quot;</span><span class="p">,</span><span class="nx">tok</span><span class="p">}},</span><span class="nx">attrs</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">if</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">[</span><span class="mi">0</span><span class="p">]){</span><span class="kd">var</span> <span class="nx">index</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">indexOfDelimiters</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span><span class="s2">&quot;)&quot;</span><span class="p">),</span><span class="nx">str</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nx">index</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="nx">tok</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">tok</span><span class="p">(</span><span class="s2">&quot;attrs&quot;</span><span class="p">),</span><span class="nx">len</span><span class="o">=</span><span class="nx">str</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span><span class="nx">colons</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">colons</span><span class="p">,</span><span class="nx">states</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">],</span><span class="nx">key</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="nx">val</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="nx">quote</span><span class="p">,</span><span class="nx">c</span><span class="p">;</span><span class="kd">function</span> <span class="nx">state</span><span class="p">(){</span><span class="k">return</span> <span class="nx">states</span><span class="p">[</span><span class="nx">states</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]}</span><span class="kd">function</span> <span class="nx">interpolate</span><span class="p">(</span><span class="nx">attr</span><span class="p">){</span><span class="k">return</span> <span class="nx">attr</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/#\{([^}]+)\}/g</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">_</span><span class="p">,</span><span class="nx">expr</span><span class="p">){</span><span class="k">return</span> <span class="nx">quote</span><span class="o">+</span><span class="s2">&quot; + (&quot;</span><span class="o">+</span><span class="nx">expr</span><span class="o">+</span><span class="s2">&quot;) + &quot;</span><span class="o">+</span><span class="nx">quote</span><span class="p">})}</span><span class="k">this</span><span class="p">.</span><span class="nx">consume</span><span class="p">(</span><span class="nx">index</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="nx">tok</span><span class="p">.</span><span class="nx">attrs</span><span class="o">=</span><span class="p">{};</span><span class="kd">function</span> <span class="nx">parse</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span><span class="kd">var</span> <span class="nx">real</span><span class="o">=</span><span class="nx">c</span><span class="p">;</span><span class="nx">colons</span><span class="o">&amp;&amp;</span><span class="s2">&quot;:&quot;</span><span class="o">==</span><span class="nx">c</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">c</span><span class="o">=</span><span class="s2">&quot;=&quot;</span><span class="p">);</span><span class="k">switch</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span><span class="k">case</span><span class="s2">&quot;,&quot;</span><span class="o">:</span><span class="k">case</span><span class="s2">&quot;\n&quot;</span><span class="o">:</span><span class="k">switch</span><span class="p">(</span><span class="nx">state</span><span class="p">()){</span><span class="k">case</span><span class="s2">&quot;expr&quot;</span><span class="o">:</span><span class="k">case</span><span class="s2">&quot;array&quot;</span><span class="o">:</span><span class="k">case</span><span class="s2">&quot;string&quot;</span><span class="o">:</span><span class="k">case</span><span class="s2">&quot;object&quot;</span><span class="o">:</span><span class="nx">val</span><span class="o">+=</span><span class="nx">c</span><span class="p">;</span><span class="k">break</span><span class="p">;</span><span class="k">default</span><span class="o">:</span><span class="nx">states</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">),</span><span class="nx">val</span><span class="o">=</span><span class="nx">val</span><span class="p">.</span><span class="nx">trim</span><span class="p">(),</span><span class="nx">key</span><span class="o">=</span><span class="nx">key</span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span><span class="k">if</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">==</span><span class="nx">key</span><span class="p">)</span><span class="k">return</span><span class="p">;</span><span class="nx">tok</span><span class="p">.</span><span class="nx">attrs</span><span class="p">[</span><span class="nx">key</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^[&#39;&quot;]|[&#39;&quot;]$/g</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)]</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="o">==</span><span class="nx">val</span><span class="o">?!</span><span class="mi">0</span><span class="o">:</span><span class="nx">interpolate</span><span class="p">(</span><span class="nx">val</span><span class="p">),</span><span class="nx">key</span><span class="o">=</span><span class="nx">val</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">}</span><span class="k">break</span><span class="p">;</span><span class="k">case</span><span class="s2">&quot;=&quot;</span><span class="o">:</span><span class="k">switch</span><span class="p">(</span><span class="nx">state</span><span class="p">()){</span><span class="k">case</span><span class="s2">&quot;key char&quot;</span><span class="o">:</span><span class="nx">key</span><span class="o">+=</span><span class="nx">real</span><span class="p">;</span><span class="k">break</span><span class="p">;</span><span class="k">case</span><span class="s2">&quot;val&quot;</span><span class="o">:</span><span class="k">case</span><span class="s2">&quot;expr&quot;</span><span class="o">:</span><span class="k">case</span><span class="s2">&quot;array&quot;</span><span class="o">:</span><span class="k">case</span><span class="s2">&quot;string&quot;</span><span class="o">:</span><span class="k">case</span><span class="s2">&quot;object&quot;</span><span class="o">:</span><span class="nx">val</span><span class="o">+=</span><span class="nx">real</span><span class="p">;</span><span class="k">break</span><span class="p">;</span><span class="k">default</span><span class="o">:</span><span class="nx">states</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;val&quot;</span><span class="p">)}</span><span class="k">break</span><span class="p">;</span><span class="k">case</span><span class="s2">&quot;(&quot;</span><span class="o">:</span><span class="p">(</span><span class="s2">&quot;val&quot;</span><span class="o">==</span><span class="nx">state</span><span class="p">()</span><span class="o">||</span><span class="s2">&quot;expr&quot;</span><span class="o">==</span><span class="nx">state</span><span class="p">())</span><span class="o">&amp;&amp;</span><span class="nx">states</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;expr&quot;</span><span class="p">),</span><span class="nx">val</span><span class="o">+=</span><span class="nx">c</span><span class="p">;</span><span class="k">break</span><span class="p">;</span><span class="k">case</span><span class="s2">&quot;)&quot;</span><span class="o">:</span><span class="p">(</span><span class="s2">&quot;expr&quot;</span><span class="o">==</span><span class="nx">state</span><span class="p">()</span><span class="o">||</span><span class="s2">&quot;val&quot;</span><span class="o">==</span><span class="nx">state</span><span class="p">())</span><span class="o">&amp;&amp;</span><span class="nx">states</span><span class="p">.</span><span class="nx">pop</span><span class="p">(),</span><span class="nx">val</span><span class="o">+=</span><span class="nx">c</span><span class="p">;</span><span class="k">break</span><span class="p">;</span><span class="k">case</span><span class="s2">&quot;{&quot;</span><span class="o">:</span><span class="s2">&quot;val&quot;</span><span class="o">==</span><span class="nx">state</span><span class="p">()</span><span class="o">&amp;&amp;</span><span class="nx">states</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;object&quot;</span><span class="p">),</span><span class="nx">val</span><span class="o">+=</span><span class="nx">c</span><span class="p">;</span><span class="k">break</span><span class="p">;</span><span class="k">case</span><span class="s2">&quot;}&quot;</span><span class="o">:</span><span class="s2">&quot;object&quot;</span><span class="o">==</span><span class="nx">state</span><span class="p">()</span><span class="o">&amp;&amp;</span><span class="nx">states</span><span class="p">.</span><span class="nx">pop</span><span class="p">(),</span><span class="nx">val</span><span class="o">+=</span><span class="nx">c</span><span class="p">;</span><span class="k">break</span><span class="p">;</span><span class="k">case</span><span class="s2">&quot;[&quot;</span><span class="o">:</span><span class="s2">&quot;val&quot;</span><span class="o">==</span><span class="nx">state</span><span class="p">()</span><span class="o">&amp;&amp;</span><span class="nx">states</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;array&quot;</span><span class="p">),</span><span class="nx">val</span><span class="o">+=</span><span class="nx">c</span><span class="p">;</span><span class="k">break</span><span class="p">;</span><span class="k">case</span><span class="s2">&quot;]&quot;</span><span class="o">:</span><span class="s2">&quot;array&quot;</span><span class="o">==</span><span class="nx">state</span><span class="p">()</span><span class="o">&amp;&amp;</span><span class="nx">states</span><span class="p">.</span><span class="nx">pop</span><span class="p">(),</span><span class="nx">val</span><span class="o">+=</span><span class="nx">c</span><span class="p">;</span><span class="k">break</span><span class="p">;</span><span class="k">case</span><span class="s1">&#39;&quot;&#39;</span><span class="o">:</span><span class="k">case</span><span class="s2">&quot;&#39;&quot;</span><span class="o">:</span><span class="k">switch</span><span class="p">(</span><span class="nx">state</span><span class="p">()){</span><span class="k">case</span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="nx">states</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;key char&quot;</span><span class="p">);</span><span class="k">break</span><span class="p">;</span><span class="k">case</span><span class="s2">&quot;key char&quot;</span><span class="o">:</span><span class="nx">states</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span><span class="k">break</span><span class="p">;</span><span class="k">case</span><span class="s2">&quot;string&quot;</span><span class="o">:</span><span class="nx">c</span><span class="o">==</span><span class="nx">quote</span><span class="o">&amp;&amp;</span><span class="nx">states</span><span class="p">.</span><span class="nx">pop</span><span class="p">(),</span><span class="nx">val</span><span class="o">+=</span><span class="nx">c</span><span class="p">;</span><span class="k">break</span><span class="p">;</span><span class="k">default</span><span class="o">:</span><span class="nx">states</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">),</span><span class="nx">val</span><span class="o">+=</span><span class="nx">c</span><span class="p">,</span><span class="nx">quote</span><span class="o">=</span><span class="nx">c</span><span class="p">}</span><span class="k">break</span><span class="p">;</span><span class="k">case</span><span class="s2">&quot;&quot;</span><span class="o">:</span><span class="k">break</span><span class="p">;</span><span class="k">default</span><span class="o">:</span><span class="k">switch</span><span class="p">(</span><span class="nx">state</span><span class="p">()){</span><span class="k">case</span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="k">case</span><span class="s2">&quot;key char&quot;</span><span class="o">:</span><span class="nx">key</span><span class="o">+=</span><span class="nx">c</span><span class="p">;</span><span class="k">break</span><span class="p">;</span><span class="k">default</span><span class="o">:</span><span class="nx">val</span><span class="o">+=</span><span class="nx">c</span><span class="p">}}}</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="nx">parse</span><span class="p">(</span><span class="nx">str</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span><span class="k">return</span> <span class="nx">parse</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">),</span><span class="nx">tok</span><span class="p">}},</span><span class="nx">indent</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">captures</span><span class="p">,</span><span class="nx">re</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">indentRe</span><span class="o">?</span><span class="nx">captures</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">indentRe</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">)</span><span class="o">:</span><span class="p">(</span><span class="nx">re</span><span class="o">=</span><span class="sr">/^\n(\t*) */</span><span class="p">,</span><span class="nx">captures</span><span class="o">=</span><span class="nx">re</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">),</span><span class="nx">captures</span><span class="o">&amp;&amp;!</span><span class="nx">captures</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">length</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">re</span><span class="o">=</span><span class="sr">/^\n( *)/</span><span class="p">,</span><span class="nx">captures</span><span class="o">=</span><span class="nx">re</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">)),</span><span class="nx">captures</span><span class="o">&amp;&amp;</span><span class="nx">captures</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">length</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">indentRe</span><span class="o">=</span><span class="nx">re</span><span class="p">));</span><span class="k">if</span><span class="p">(</span><span class="nx">captures</span><span class="p">){</span><span class="kd">var</span> <span class="nx">tok</span><span class="p">,</span><span class="nx">indents</span><span class="o">=</span><span class="nx">captures</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span><span class="o">++</span><span class="k">this</span><span class="p">.</span><span class="nx">lineno</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">consume</span><span class="p">(</span><span class="nx">indents</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">||</span><span class="s2">&quot;\t&quot;</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Invalid indentation, you can use tabs or spaces but not both&quot;</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">tok</span><span class="p">(</span><span class="s2">&quot;newline&quot;</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">indentStack</span><span class="p">.</span><span class="nx">length</span><span class="o">&amp;&amp;</span><span class="nx">indents</span><span class="o">&lt;</span><span class="k">this</span><span class="p">.</span><span class="nx">indentStack</span><span class="p">[</span><span class="mi">0</span><span class="p">]){</span><span class="k">while</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">indentStack</span><span class="p">.</span><span class="nx">length</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">indentStack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="nx">indents</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">stash</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tok</span><span class="p">(</span><span class="s2">&quot;outdent&quot;</span><span class="p">)),</span><span class="k">this</span><span class="p">.</span><span class="nx">indentStack</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span><span class="nx">tok</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">stash</span><span class="p">.</span><span class="nx">pop</span><span class="p">()}</span><span class="k">else</span> <span class="nx">indents</span><span class="o">&amp;&amp;</span><span class="nx">indents</span><span class="o">!=</span><span class="k">this</span><span class="p">.</span><span class="nx">indentStack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">?</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">indentStack</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">indents</span><span class="p">),</span><span class="nx">tok</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">tok</span><span class="p">(</span><span class="s2">&quot;indent&quot;</span><span class="p">,</span><span class="nx">indents</span><span class="p">))</span><span class="o">:</span><span class="nx">tok</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">tok</span><span class="p">(</span><span class="s2">&quot;newline&quot;</span><span class="p">);</span><span class="k">return</span> <span class="nx">tok</span><span class="p">}},</span><span class="nx">pipelessText</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pipeless</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="k">return</span><span class="p">;</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">);</span><span class="o">-</span><span class="mi">1</span><span class="o">==</span><span class="nx">i</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span><span class="kd">var</span> <span class="nx">str</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nx">i</span><span class="p">);</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">consume</span><span class="p">(</span><span class="nx">str</span><span class="p">.</span><span class="nx">length</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">tok</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span><span class="nx">str</span><span class="p">)}},</span><span class="nx">colon</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">scan</span><span class="p">(</span><span class="sr">/^: */</span><span class="p">,</span><span class="s2">&quot;:&quot;</span><span class="p">)},</span><span class="nx">advance</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">stashed</span><span class="p">()</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">next</span><span class="p">()},</span><span class="nx">next</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">deferred</span><span class="p">()</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">eos</span><span class="p">()</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">pipelessText</span><span class="p">()</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">doctype</span><span class="p">()</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="k">case</span><span class="p">()</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">when</span><span class="p">()</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="k">default</span><span class="p">()</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="kr">extends</span><span class="p">()</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">block</span><span class="p">()</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">include</span><span class="p">()</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">mixin</span><span class="p">()</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">conditional</span><span class="p">()</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">()</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="k">while</span><span class="p">()</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">assignment</span><span class="p">()</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">tag</span><span class="p">()</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">filter</span><span class="p">()</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">code</span><span class="p">()</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">()</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">className</span><span class="p">()</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">attrs</span><span class="p">()</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">indent</span><span class="p">()</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">comment</span><span class="p">()</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">colon</span><span class="p">()</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">text</span><span class="p">()}}}),</span><span class="nx">require</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;nodes/block-comment.js&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">,</span><span class="nx">require</span><span class="p">){</span><span class="kd">var</span> <span class="nx">Node</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./node&quot;</span><span class="p">),</span><span class="nx">BlockComment</span><span class="o">=</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">,</span><span class="nx">block</span><span class="p">,</span><span class="nx">buffer</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">block</span><span class="o">=</span><span class="nx">block</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">val</span><span class="o">=</span><span class="nx">val</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="o">=</span><span class="nx">buffer</span><span class="p">};</span><span class="nx">BlockComment</span><span class="p">.</span><span class="nx">prototype</span><span class="o">=</span><span class="k">new</span> <span class="nx">Node</span><span class="p">,</span><span class="nx">BlockComment</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span><span class="o">=</span><span class="nx">BlockComment</span><span class="p">}),</span><span class="nx">require</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;nodes/block.js&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">,</span><span class="nx">require</span><span class="p">){</span><span class="kd">var</span> <span class="nx">Node</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./node&quot;</span><span class="p">),</span><span class="nx">Block</span><span class="o">=</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">nodes</span><span class="o">=</span><span class="p">[],</span><span class="nx">node</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">node</span><span class="p">)};</span><span class="nx">Block</span><span class="p">.</span><span class="nx">prototype</span><span class="o">=</span><span class="k">new</span> <span class="nx">Node</span><span class="p">,</span><span class="nx">Block</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span><span class="o">=</span><span class="nx">Block</span><span class="p">,</span><span class="nx">Block</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">replace</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">other</span><span class="p">){</span><span class="nx">other</span><span class="p">.</span><span class="nx">nodes</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">nodes</span><span class="p">},</span><span class="nx">Block</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">push</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">node</span><span class="p">)},</span><span class="nx">Block</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isEmpty</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="mi">0</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">},</span><span class="nx">Block</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">unshift</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">node</span><span class="p">)},</span><span class="nx">Block</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">lastBlock</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">last</span><span class="o">=</span><span class="k">this</span><span class="p">,</span><span class="nx">node</span><span class="p">;</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">len</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="nx">node</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span><span class="nx">node</span><span class="p">.</span><span class="nx">nodes</span><span class="o">?</span><span class="nx">last</span><span class="o">=</span><span class="nx">node</span><span class="p">.</span><span class="nx">lastBlock</span><span class="p">()</span><span class="o">:</span><span class="nx">node</span><span class="p">.</span><span class="nx">block</span><span class="o">&amp;&amp;!</span><span class="nx">node</span><span class="p">.</span><span class="nx">block</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">()</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">last</span><span class="o">=</span><span class="nx">node</span><span class="p">.</span><span class="nx">block</span><span class="p">.</span><span class="nx">lastBlock</span><span class="p">());</span><span class="k">return</span> <span class="nx">last</span><span class="p">}}),</span><span class="nx">require</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;nodes/case.js&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">,</span><span class="nx">require</span><span class="p">){</span><span class="kd">var</span> <span class="nx">Node</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./node&quot;</span><span class="p">),</span><span class="nx">Case</span><span class="o">=</span><span class="nx">exports</span><span class="o">=</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">expr</span><span class="p">,</span><span class="nx">block</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">expr</span><span class="o">=</span><span class="nx">expr</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">block</span><span class="o">=</span><span class="nx">block</span><span class="p">};</span><span class="nx">Case</span><span class="p">.</span><span class="nx">prototype</span><span class="o">=</span><span class="k">new</span> <span class="nx">Node</span><span class="p">,</span><span class="nx">Case</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span><span class="o">=</span><span class="nx">Case</span><span class="p">;</span><span class="kd">var</span> <span class="nx">When</span><span class="o">=</span><span class="nx">exports</span><span class="p">.</span><span class="nx">When</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">expr</span><span class="p">,</span><span class="nx">block</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">expr</span><span class="o">=</span><span class="nx">expr</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">block</span><span class="o">=</span><span class="nx">block</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="o">=!</span><span class="mi">1</span><span class="p">};</span><span class="nx">When</span><span class="p">.</span><span class="nx">prototype</span><span class="o">=</span><span class="k">new</span> <span class="nx">Node</span><span class="p">,</span><span class="nx">When</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span><span class="o">=</span><span class="nx">When</span><span class="p">}),</span><span class="nx">require</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;nodes/code.js&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">,</span><span class="nx">require</span><span class="p">){</span><span class="kd">var</span> <span class="nx">Node</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./node&quot;</span><span class="p">),</span><span class="nx">Code</span><span class="o">=</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">,</span><span class="nx">buffer</span><span class="p">,</span><span class="nx">escape</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">val</span><span class="o">=</span><span class="nx">val</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="o">=</span><span class="nx">buffer</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">escape</span><span class="o">=</span><span class="nx">escape</span><span class="p">,</span><span class="nx">val</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^ *else/</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="o">=!</span><span class="mi">1</span><span class="p">)};</span><span class="nx">Code</span><span class="p">.</span><span class="nx">prototype</span><span class="o">=</span><span class="k">new</span> <span class="nx">Node</span><span class="p">,</span><span class="nx">Code</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span><span class="o">=</span><span class="nx">Code</span><span class="p">}),</span><span class="nx">require</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;nodes/comment.js&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">,</span><span class="nx">require</span><span class="p">){</span><span class="kd">var</span> <span class="nx">Node</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./node&quot;</span><span class="p">),</span><span class="nx">Comment</span><span class="o">=</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">,</span><span class="nx">buffer</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">val</span><span class="o">=</span><span class="nx">val</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="o">=</span><span class="nx">buffer</span><span class="p">};</span><span class="nx">Comment</span><span class="p">.</span><span class="nx">prototype</span><span class="o">=</span><span class="k">new</span> <span class="nx">Node</span><span class="p">,</span><span class="nx">Comment</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span><span class="o">=</span><span class="nx">Comment</span><span class="p">}),</span><span class="nx">require</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;nodes/doctype.js&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">,</span><span class="nx">require</span><span class="p">){</span><span class="kd">var</span> <span class="nx">Node</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./node&quot;</span><span class="p">),</span><span class="nx">Doctype</span><span class="o">=</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">val</span><span class="o">=</span><span class="nx">val</span><span class="p">};</span><span class="nx">Doctype</span><span class="p">.</span><span class="nx">prototype</span><span class="o">=</span><span class="k">new</span> <span class="nx">Node</span><span class="p">,</span><span class="nx">Doctype</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span><span class="o">=</span><span class="nx">Doctype</span><span class="p">}),</span><span class="nx">require</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;nodes/each.js&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">,</span><span class="nx">require</span><span class="p">){</span><span class="kd">var</span> <span class="nx">Node</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./node&quot;</span><span class="p">),</span><span class="nx">Each</span><span class="o">=</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span><span class="nx">val</span><span class="p">,</span><span class="nx">key</span><span class="p">,</span><span class="nx">block</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">obj</span><span class="o">=</span><span class="nx">obj</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">val</span><span class="o">=</span><span class="nx">val</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="o">=</span><span class="nx">key</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">block</span><span class="o">=</span><span class="nx">block</span><span class="p">};</span><span class="nx">Each</span><span class="p">.</span><span class="nx">prototype</span><span class="o">=</span><span class="k">new</span> <span class="nx">Node</span><span class="p">,</span><span class="nx">Each</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span><span class="o">=</span><span class="nx">Each</span><span class="p">}),</span><span class="nx">require</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;nodes/filter.js&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">,</span><span class="nx">require</span><span class="p">){</span><span class="kd">var</span> <span class="nx">Node</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./node&quot;</span><span class="p">),</span><span class="nx">Block</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./block&quot;</span><span class="p">),</span><span class="nx">Filter</span><span class="o">=</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="nx">block</span><span class="p">,</span><span class="nx">attrs</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="o">=</span><span class="nx">name</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">block</span><span class="o">=</span><span class="nx">block</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">attrs</span><span class="o">=</span><span class="nx">attrs</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">isASTFilter</span><span class="o">=</span><span class="nx">block</span> <span class="k">instanceof</span> <span class="nx">Block</span><span class="p">};</span><span class="nx">Filter</span><span class="p">.</span><span class="nx">prototype</span><span class="o">=</span><span class="k">new</span> <span class="nx">Node</span><span class="p">,</span><span class="nx">Filter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span><span class="o">=</span><span class="nx">Filter</span><span class="p">}),</span><span class="nx">require</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;nodes/index.js&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">,</span><span class="nx">require</span><span class="p">){</span><span class="nx">exports</span><span class="p">.</span><span class="nx">Node</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./node&quot;</span><span class="p">),</span><span class="nx">exports</span><span class="p">.</span><span class="nx">Tag</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./tag&quot;</span><span class="p">),</span><span class="nx">exports</span><span class="p">.</span><span class="nx">Code</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./code&quot;</span><span class="p">),</span><span class="nx">exports</span><span class="p">.</span><span class="nx">Each</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./each&quot;</span><span class="p">),</span><span class="nx">exports</span><span class="p">.</span><span class="nx">Case</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./case&quot;</span><span class="p">),</span><span class="nx">exports</span><span class="p">.</span><span class="nx">Text</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./text&quot;</span><span class="p">),</span><span class="nx">exports</span><span class="p">.</span><span class="nx">Block</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./block&quot;</span><span class="p">),</span><span class="nx">exports</span><span class="p">.</span><span class="nx">Mixin</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./mixin&quot;</span><span class="p">),</span><span class="nx">exports</span><span class="p">.</span><span class="nx">Filter</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./filter&quot;</span><span class="p">),</span><span class="nx">exports</span><span class="p">.</span><span class="nx">Comment</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./comment&quot;</span><span class="p">),</span><span class="nx">exports</span><span class="p">.</span><span class="nx">Literal</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./literal&quot;</span><span class="p">),</span><span class="nx">exports</span><span class="p">.</span><span class="nx">BlockComment</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./block-comment&quot;</span><span class="p">),</span><span class="nx">exports</span><span class="p">.</span><span class="nx">Doctype</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./doctype&quot;</span><span class="p">)}),</span><span class="nx">require</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;nodes/literal.js&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">,</span><span class="nx">require</span><span class="p">){</span><span class="kd">var</span> <span class="nx">Node</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./node&quot;</span><span class="p">),</span><span class="nx">Literal</span><span class="o">=</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">str</span><span class="o">=</span><span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\n/g</span><span class="p">,</span><span class="s2">&quot;\\n&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&#39;/g</span><span class="p">,</span><span class="s2">&quot;\\&#39;&quot;</span><span class="p">)};</span><span class="nx">Literal</span><span class="p">.</span><span class="nx">prototype</span><span class="o">=</span><span class="k">new</span> <span class="nx">Node</span><span class="p">,</span><span class="nx">Literal</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span><span class="o">=</span><span class="nx">Literal</span><span class="p">}),</span><span class="nx">require</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;nodes/mixin.js&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">,</span><span class="nx">require</span><span class="p">){</span><span class="kd">var</span> <span class="nx">Node</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./node&quot;</span><span class="p">),</span><span class="nx">Mixin</span><span class="o">=</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="nx">args</span><span class="p">,</span><span class="nx">block</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="o">=</span><span class="nx">name</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">args</span><span class="o">=</span><span class="nx">args</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">block</span><span class="o">=</span><span class="nx">block</span><span class="p">};</span><span class="nx">Mixin</span><span class="p">.</span><span class="nx">prototype</span><span class="o">=</span><span class="k">new</span> <span class="nx">Node</span><span class="p">,</span><span class="nx">Mixin</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span><span class="o">=</span><span class="nx">Mixin</span><span class="p">}),</span><span class="nx">require</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;nodes/node.js&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">,</span><span class="nx">require</span><span class="p">){</span><span class="kd">var</span> <span class="nx">Node</span><span class="o">=</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">=</span><span class="kd">function</span><span class="p">(){}}),</span><span class="nx">require</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;nodes/tag.js&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">,</span><span class="nx">require</span><span class="p">){</span><span class="kd">var</span> <span class="nx">Node</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./node&quot;</span><span class="p">),</span><span class="nx">Block</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./block&quot;</span><span class="p">),</span><span class="nx">Tag</span><span class="o">=</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="nx">block</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="o">=</span><span class="nx">name</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">attrs</span><span class="o">=</span><span class="p">[],</span><span class="k">this</span><span class="p">.</span><span class="nx">block</span><span class="o">=</span><span class="nx">block</span><span class="o">||</span><span class="k">new</span> <span class="nx">Block</span><span class="p">};</span><span class="nx">Tag</span><span class="p">.</span><span class="nx">prototype</span><span class="o">=</span><span class="k">new</span> <span class="nx">Node</span><span class="p">,</span><span class="nx">Tag</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span><span class="o">=</span><span class="nx">Tag</span><span class="p">,</span><span class="nx">Tag</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setAttribute</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="nx">val</span><span class="p">){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span><span class="nx">name</span><span class="p">,</span><span class="nx">val</span><span class="o">:</span><span class="nx">val</span><span class="p">}),</span><span class="k">this</span><span class="p">},</span><span class="nx">Tag</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeAttribute</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">){</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">len</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">attrs</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">attrs</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span><span class="o">==</span><span class="nx">name</span><span class="o">&amp;&amp;</span><span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">attrs</span><span class="p">[</span><span class="nx">i</span><span class="p">]},</span><span class="nx">Tag</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getAttribute</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">){</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">len</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">attrs</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">attrs</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span><span class="o">==</span><span class="nx">name</span><span class="p">)</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">attrs</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">val</span><span class="p">}}),</span><span class="nx">require</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;nodes/text.js&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">,</span><span class="nx">require</span><span class="p">){</span><span class="kd">var</span> <span class="nx">Node</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./node&quot;</span><span class="p">),</span><span class="nx">Text</span><span class="o">=</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">line</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">nodes</span><span class="o">=</span><span class="p">[],</span><span class="s2">&quot;string&quot;</span><span class="o">==</span><span class="k">typeof</span> <span class="nx">line</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">line</span><span class="p">)};</span><span class="nx">Text</span><span class="p">.</span><span class="nx">prototype</span><span class="o">=</span><span class="k">new</span> <span class="nx">Node</span><span class="p">,</span><span class="nx">Text</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span><span class="o">=</span><span class="nx">Text</span><span class="p">,</span><span class="nx">Text</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">push</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">node</span><span class="p">)}}),</span><span class="nx">require</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;parser.js&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">,</span><span class="nx">require</span><span class="p">){</span><span class="kd">var</span> <span class="nx">Lexer</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./lexer&quot;</span><span class="p">),</span><span class="nx">nodes</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./nodes&quot;</span><span class="p">),</span><span class="nx">Parser</span><span class="o">=</span><span class="nx">exports</span><span class="o">=</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span><span class="nx">filename</span><span class="p">,</span><span class="nx">options</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="o">=</span><span class="nx">str</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">lexer</span><span class="o">=</span><span class="k">new</span> <span class="nx">Lexer</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span><span class="nx">options</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">filename</span><span class="o">=</span><span class="nx">filename</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">blocks</span><span class="o">=</span><span class="p">{},</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="o">=</span><span class="nx">options</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">contexts</span><span class="o">=</span><span class="p">[</span><span class="k">this</span><span class="p">]},</span><span class="nx">textOnly</span><span class="o">=</span><span class="nx">exports</span><span class="p">.</span><span class="nx">textOnly</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">,</span><span class="s2">&quot;script&quot;</span><span class="p">,</span><span class="s2">&quot;textarea&quot;</span><span class="p">,</span><span class="s2">&quot;style&quot;</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">];</span><span class="nx">Parser</span><span class="p">.</span><span class="nx">prototype</span><span class="o">=</span><span class="p">{</span><span class="nx">context</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">parser</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">parser</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">parser</span><span class="p">);</span><span class="k">else</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">contexts</span><span class="p">.</span><span class="nx">pop</span><span class="p">()},</span><span class="nx">advance</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">lexer</span><span class="p">.</span><span class="nx">advance</span><span class="p">()},</span><span class="nx">skip</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">){</span><span class="k">while</span><span class="p">(</span><span class="nx">n</span><span class="o">--</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">advance</span><span class="p">()},</span><span class="nx">peek</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">lookahead</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span><span class="nx">line</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">lexer</span><span class="p">.</span><span class="nx">lineno</span><span class="p">},</span><span class="nx">lookahead</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">lexer</span><span class="p">.</span><span class="nx">lookahead</span><span class="p">(</span><span class="nx">n</span><span class="p">)},</span><span class="nx">parse</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">block</span><span class="o">=</span><span class="k">new</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">Block</span><span class="p">,</span><span class="nx">parser</span><span class="p">;</span><span class="nx">block</span><span class="p">.</span><span class="nx">line</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">line</span><span class="p">();</span><span class="k">while</span><span class="p">(</span><span class="s2">&quot;eos&quot;</span><span class="o">!=</span><span class="k">this</span><span class="p">.</span><span class="nx">peek</span><span class="p">().</span><span class="nx">type</span><span class="p">)</span><span class="s2">&quot;newline&quot;</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">peek</span><span class="p">().</span><span class="nx">type</span><span class="o">?</span><span class="k">this</span><span class="p">.</span><span class="nx">advance</span><span class="p">()</span><span class="o">:</span><span class="nx">block</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">parseExpr</span><span class="p">());</span><span class="k">if</span><span class="p">(</span><span class="nx">parser</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">extending</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">(</span><span class="nx">parser</span><span class="p">);</span><span class="kd">var</span> <span class="nx">ast</span><span class="o">=</span><span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">();</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">(),</span><span class="nx">ast</span><span class="p">}</span><span class="k">return</span> <span class="nx">block</span><span class="p">},</span><span class="nx">expect</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">peek</span><span class="p">().</span><span class="nx">type</span><span class="o">===</span><span class="nx">type</span><span class="p">)</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">advance</span><span class="p">();</span><span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;expected &quot;&#39;</span><span class="o">+</span><span class="nx">type</span><span class="o">+</span><span class="s1">&#39;&quot;, but got &quot;&#39;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">peek</span><span class="p">().</span><span class="nx">type</span><span class="o">+</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)},</span><span class="nx">accept</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">peek</span><span class="p">().</span><span class="nx">type</span><span class="o">===</span><span class="nx">type</span><span class="p">)</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">advance</span><span class="p">()},</span><span class="nx">parseExpr</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">switch</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">peek</span><span class="p">().</span><span class="nx">type</span><span class="p">){</span><span class="k">case</span><span class="s2">&quot;tag&quot;</span><span class="o">:</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseTag</span><span class="p">();</span><span class="k">case</span><span class="s2">&quot;mixin&quot;</span><span class="o">:</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseMixin</span><span class="p">();</span><span class="k">case</span><span class="s2">&quot;block&quot;</span><span class="o">:</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseBlock</span><span class="p">();</span><span class="k">case</span><span class="s2">&quot;case&quot;</span><span class="o">:</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseCase</span><span class="p">();</span><span class="k">case</span><span class="s2">&quot;when&quot;</span><span class="o">:</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseWhen</span><span class="p">();</span><span class="k">case</span><span class="s2">&quot;default&quot;</span><span class="o">:</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseDefault</span><span class="p">();</span><span class="k">case</span><span class="s2">&quot;extends&quot;</span><span class="o">:</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseExtends</span><span class="p">();</span><span class="k">case</span><span class="s2">&quot;include&quot;</span><span class="o">:</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseInclude</span><span class="p">();</span><span class="k">case</span><span class="s2">&quot;doctype&quot;</span><span class="o">:</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseDoctype</span><span class="p">();</span><span class="k">case</span><span class="s2">&quot;filter&quot;</span><span class="o">:</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseFilter</span><span class="p">();</span><span class="k">case</span><span class="s2">&quot;comment&quot;</span><span class="o">:</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseComment</span><span class="p">();</span><span class="k">case</span><span class="s2">&quot;text&quot;</span><span class="o">:</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseText</span><span class="p">();</span><span class="k">case</span><span class="s2">&quot;each&quot;</span><span class="o">:</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseEach</span><span class="p">();</span><span class="k">case</span><span class="s2">&quot;code&quot;</span><span class="o">:</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseCode</span><span class="p">();</span><span class="k">case</span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="k">case</span><span class="s2">&quot;class&quot;</span><span class="o">:</span><span class="kd">var</span> <span class="nx">tok</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">advance</span><span class="p">();</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">lexer</span><span class="p">.</span><span class="nx">defer</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">lexer</span><span class="p">.</span><span class="nx">tok</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">,</span><span class="s2">&quot;div&quot;</span><span class="p">)),</span><span class="k">this</span><span class="p">.</span><span class="nx">lexer</span><span class="p">.</span><span class="nx">defer</span><span class="p">(</span><span class="nx">tok</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">parseExpr</span><span class="p">();</span><span class="k">default</span><span class="o">:</span><span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;unexpected token &quot;&#39;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">peek</span><span class="p">().</span><span class="nx">type</span><span class="o">+</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)}},</span><span class="nx">parseText</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">tok</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">),</span><span class="nx">node</span><span class="o">=</span><span class="k">new</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">Text</span><span class="p">(</span><span class="nx">tok</span><span class="p">.</span><span class="nx">val</span><span class="p">);</span><span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">line</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">line</span><span class="p">(),</span><span class="nx">node</span><span class="p">},</span><span class="nx">parseBlockExpansion</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span><span class="s2">&quot;:&quot;</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">peek</span><span class="p">().</span><span class="nx">type</span><span class="o">?</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">advance</span><span class="p">(),</span><span class="k">new</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">Block</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">parseExpr</span><span class="p">()))</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">block</span><span class="p">()},</span><span class="nx">parseCase</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">val</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;case&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">,</span><span class="nx">node</span><span class="o">=</span><span class="k">new</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">Case</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span><span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">line</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">line</span><span class="p">(),</span><span class="nx">node</span><span class="p">.</span><span class="nx">block</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">block</span><span class="p">(),</span><span class="nx">node</span><span class="p">},</span><span class="nx">parseWhen</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">val</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;when&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">;</span><span class="k">return</span> <span class="k">new</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">Case</span><span class="p">.</span><span class="nx">When</span><span class="p">(</span><span class="nx">val</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">parseBlockExpansion</span><span class="p">())},</span><span class="nx">parseDefault</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">),</span><span class="k">new</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">Case</span><span class="p">.</span><span class="nx">When</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">parseBlockExpansion</span><span class="p">())},</span><span class="nx">parseCode</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">tok</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">),</span><span class="nx">node</span><span class="o">=</span><span class="k">new</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">Code</span><span class="p">(</span><span class="nx">tok</span><span class="p">.</span><span class="nx">val</span><span class="p">,</span><span class="nx">tok</span><span class="p">.</span><span class="nx">buffer</span><span class="p">,</span><span class="nx">tok</span><span class="p">.</span><span class="nx">escape</span><span class="p">),</span><span class="nx">block</span><span class="p">,</span><span class="nx">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="nx">node</span><span class="p">.</span><span class="nx">line</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">line</span><span class="p">();</span><span class="k">while</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">lookahead</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="s2">&quot;newline&quot;</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">lookahead</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">type</span><span class="p">)</span><span class="o">++</span><span class="nx">i</span><span class="p">;</span><span class="k">return</span> <span class="nx">block</span><span class="o">=</span><span class="s2">&quot;indent&quot;</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">lookahead</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">type</span><span class="p">,</span><span class="nx">block</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">skip</span><span class="p">(</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="nx">node</span><span class="p">.</span><span class="nx">block</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">block</span><span class="p">()),</span><span class="nx">node</span><span class="p">},</span><span class="nx">parseComment</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">tok</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;comment&quot;</span><span class="p">),</span><span class="nx">node</span><span class="p">;</span><span class="k">return</span><span class="s2">&quot;indent&quot;</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">peek</span><span class="p">().</span><span class="nx">type</span><span class="o">?</span><span class="nx">node</span><span class="o">=</span><span class="k">new</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">BlockComment</span><span class="p">(</span><span class="nx">tok</span><span class="p">.</span><span class="nx">val</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">block</span><span class="p">(),</span><span class="nx">tok</span><span class="p">.</span><span class="nx">buffer</span><span class="p">)</span><span class="o">:</span><span class="nx">node</span><span class="o">=</span><span class="k">new</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">Comment</span><span class="p">(</span><span class="nx">tok</span><span class="p">.</span><span class="nx">val</span><span class="p">,</span><span class="nx">tok</span><span class="p">.</span><span class="nx">buffer</span><span class="p">),</span><span class="nx">node</span><span class="p">.</span><span class="nx">line</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">line</span><span class="p">(),</span><span class="nx">node</span><span class="p">},</span><span class="nx">parseDoctype</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">tok</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;doctype&quot;</span><span class="p">),</span><span class="nx">node</span><span class="o">=</span><span class="k">new</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">Doctype</span><span class="p">(</span><span class="nx">tok</span><span class="p">.</span><span class="nx">val</span><span class="p">);</span><span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">line</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">line</span><span class="p">(),</span><span class="nx">node</span><span class="p">},</span><span class="nx">parseFilter</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">block</span><span class="p">,</span><span class="nx">tok</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;filter&quot;</span><span class="p">),</span><span class="nx">attrs</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">accept</span><span class="p">(</span><span class="s2">&quot;attrs&quot;</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">lexer</span><span class="p">.</span><span class="nx">pipeless</span><span class="o">=!</span><span class="mi">0</span><span class="p">,</span><span class="nx">block</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">parseTextBlock</span><span class="p">(),</span><span class="k">this</span><span class="p">.</span><span class="nx">lexer</span><span class="p">.</span><span class="nx">pipeless</span><span class="o">=!</span><span class="mi">1</span><span class="p">;</span><span class="kd">var</span> <span class="nx">node</span><span class="o">=</span><span class="k">new</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">Filter</span><span class="p">(</span><span class="nx">tok</span><span class="p">.</span><span class="nx">val</span><span class="p">,</span><span class="nx">block</span><span class="p">,</span><span class="nx">attrs</span><span class="o">&amp;&amp;</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">attrs</span><span class="p">);</span><span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">line</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">line</span><span class="p">(),</span><span class="nx">node</span><span class="p">},</span><span class="nx">parseASTFilter</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">block</span><span class="p">,</span><span class="nx">tok</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">),</span><span class="nx">attrs</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">accept</span><span class="p">(</span><span class="s2">&quot;attrs&quot;</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">),</span><span class="nx">block</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">block</span><span class="p">();</span><span class="kd">var</span> <span class="nx">node</span><span class="o">=</span><span class="k">new</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">Filter</span><span class="p">(</span><span class="nx">tok</span><span class="p">.</span><span class="nx">val</span><span class="p">,</span><span class="nx">block</span><span class="p">,</span><span class="nx">attrs</span><span class="o">&amp;&amp;</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">attrs</span><span class="p">);</span><span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">line</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">line</span><span class="p">(),</span><span class="nx">node</span><span class="p">},</span><span class="nx">parseEach</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">tok</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;each&quot;</span><span class="p">),</span><span class="nx">node</span><span class="o">=</span><span class="k">new</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">Each</span><span class="p">(</span><span class="nx">tok</span><span class="p">.</span><span class="nx">code</span><span class="p">,</span><span class="nx">tok</span><span class="p">.</span><span class="nx">val</span><span class="p">,</span><span class="nx">tok</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span><span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">line</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">line</span><span class="p">(),</span><span class="nx">node</span><span class="p">.</span><span class="nx">block</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">block</span><span class="p">(),</span><span class="nx">node</span><span class="p">},</span><span class="nx">parseExtends</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">path</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">),</span><span class="nx">fs</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">),</span><span class="nx">dirname</span><span class="o">=</span><span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">,</span><span class="nx">basename</span><span class="o">=</span><span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">,</span><span class="nx">join</span><span class="o">=</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">filename</span><span class="p">)</span><span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;the &quot;filename&quot; option is required to extend templates&#39;</span><span class="p">);</span><span class="kd">var</span> <span class="nx">path</span><span class="o">=</span><span class="nx">name</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;extends&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">.</span><span class="nx">trim</span><span class="p">(),</span><span class="nx">dir</span><span class="o">=</span><span class="nx">dirname</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">filename</span><span class="p">),</span><span class="nx">path</span><span class="o">=</span><span class="nx">join</span><span class="p">(</span><span class="nx">dir</span><span class="p">,</span><span class="nx">path</span><span class="o">+</span><span class="s2">&quot;.jade&quot;</span><span class="p">),</span><span class="nx">str</span><span class="o">=</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="s2">&quot;utf8&quot;</span><span class="p">),</span><span class="nx">parser</span><span class="o">=</span><span class="k">new</span> <span class="nx">Parser</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span><span class="nx">path</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">);</span><span class="k">return</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">blocks</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">blocks</span><span class="p">,</span><span class="nx">parser</span><span class="p">.</span><span class="nx">contexts</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">contexts</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">extending</span><span class="o">=</span><span class="nx">parser</span><span class="p">,</span><span class="k">new</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">Literal</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)},</span><span class="nx">parseBlock</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">name</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;block&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">.</span><span class="nx">trim</span><span class="p">(),</span><span class="nx">block</span><span class="o">=</span><span class="s2">&quot;indent&quot;</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">peek</span><span class="p">().</span><span class="nx">type</span><span class="o">?</span><span class="k">this</span><span class="p">.</span><span class="nx">block</span><span class="p">()</span><span class="o">:</span><span class="k">new</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">Block</span><span class="p">(</span><span class="k">new</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">Literal</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">));</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">blocks</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">blocks</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span><span class="o">||</span><span class="nx">block</span><span class="p">},</span><span class="nx">parseInclude</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">path</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">),</span><span class="nx">fs</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">),</span><span class="nx">dirname</span><span class="o">=</span><span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">,</span><span class="nx">basename</span><span class="o">=</span><span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">,</span><span class="nx">join</span><span class="o">=</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">,</span><span class="nx">path</span><span class="o">=</span><span class="nx">name</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;include&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">.</span><span class="nx">trim</span><span class="p">(),</span><span class="nx">dir</span><span class="o">=</span><span class="nx">dirname</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">filename</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">filename</span><span class="p">)</span><span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;the &quot;filename&quot; option is required to use includes&#39;</span><span class="p">);</span><span class="o">~</span><span class="nx">basename</span><span class="p">(</span><span class="nx">path</span><span class="p">).</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span><span class="o">||</span><span class="p">(</span><span class="nx">path</span><span class="o">+=</span><span class="s2">&quot;.jade&quot;</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="s2">&quot;.jade&quot;</span><span class="o">!=</span><span class="nx">path</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">)){</span><span class="kd">var</span> <span class="nx">path</span><span class="o">=</span><span class="nx">join</span><span class="p">(</span><span class="nx">dir</span><span class="p">,</span><span class="nx">path</span><span class="p">),</span><span class="nx">str</span><span class="o">=</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="s2">&quot;utf8&quot;</span><span class="p">);</span><span class="k">return</span> <span class="k">new</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">Literal</span><span class="p">(</span><span class="nx">str</span><span class="p">)}</span><span class="kd">var</span> <span class="nx">path</span><span class="o">=</span><span class="nx">join</span><span class="p">(</span><span class="nx">dir</span><span class="p">,</span><span class="nx">path</span><span class="p">),</span><span class="nx">str</span><span class="o">=</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="s2">&quot;utf8&quot;</span><span class="p">),</span><span class="nx">parser</span><span class="o">=</span><span class="k">new</span> <span class="nx">Parser</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span><span class="nx">path</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">(</span><span class="nx">parser</span><span class="p">);</span><span class="kd">var</span> <span class="nx">ast</span><span class="o">=</span><span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">();</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">(),</span><span class="nx">ast</span><span class="p">.</span><span class="nx">filename</span><span class="o">=</span><span class="nx">path</span><span class="p">,</span><span class="s2">&quot;indent&quot;</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">peek</span><span class="p">().</span><span class="nx">type</span><span class="o">&amp;&amp;</span><span class="nx">ast</span><span class="p">.</span><span class="nx">lastBlock</span><span class="p">().</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">block</span><span class="p">()),</span><span class="nx">ast</span><span class="p">},</span><span class="nx">parseMixin</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">tok</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;mixin&quot;</span><span class="p">),</span><span class="nx">name</span><span class="o">=</span><span class="nx">tok</span><span class="p">.</span><span class="nx">val</span><span class="p">,</span><span class="nx">args</span><span class="o">=</span><span class="nx">tok</span><span class="p">.</span><span class="nx">args</span><span class="p">,</span><span class="nx">block</span><span class="o">=</span><span class="s2">&quot;indent&quot;</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">peek</span><span class="p">().</span><span class="nx">type</span><span class="o">?</span><span class="k">this</span><span class="p">.</span><span class="nx">block</span><span class="p">()</span><span class="o">:</span><span class="kc">null</span><span class="p">;</span><span class="k">return</span> <span class="k">new</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">Mixin</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="nx">args</span><span class="p">,</span><span class="nx">block</span><span class="p">)},</span><span class="nx">parseTextBlock</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">text</span><span class="o">=</span><span class="k">new</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">Text</span><span class="p">;</span><span class="nx">text</span><span class="p">.</span><span class="nx">line</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">line</span><span class="p">();</span><span class="kd">var</span> <span class="nx">spaces</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;indent&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">;</span><span class="kc">null</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">_spaces</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_spaces</span><span class="o">=</span><span class="nx">spaces</span><span class="p">);</span><span class="kd">var</span> <span class="nx">indent</span><span class="o">=</span><span class="nb">Array</span><span class="p">(</span><span class="nx">spaces</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">_spaces</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">);</span><span class="k">while</span><span class="p">(</span><span class="s2">&quot;outdent&quot;</span><span class="o">!=</span><span class="k">this</span><span class="p">.</span><span class="nx">peek</span><span class="p">().</span><span class="nx">type</span><span class="p">)</span><span class="k">switch</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">peek</span><span class="p">().</span><span class="nx">type</span><span class="p">){</span><span class="k">case</span><span class="s2">&quot;newline&quot;</span><span class="o">:</span><span class="nx">text</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;\\n&quot;</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">advance</span><span class="p">();</span><span class="k">break</span><span class="p">;</span><span class="k">case</span><span class="s2">&quot;indent&quot;</span><span class="o">:</span><span class="nx">text</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;\\n&quot;</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">parseTextBlock</span><span class="p">().</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">){</span><span class="nx">text</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">node</span><span class="p">)}),</span><span class="nx">text</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;\\n&quot;</span><span class="p">);</span><span class="k">break</span><span class="p">;</span><span class="k">default</span><span class="o">:</span><span class="nx">text</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">indent</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">advance</span><span class="p">().</span><span class="nx">val</span><span class="p">)}</span><span class="k">return</span> <span class="nx">spaces</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">_spaces</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_spaces</span><span class="o">=</span><span class="kc">null</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;outdent&quot;</span><span class="p">),</span><span class="nx">text</span><span class="p">},</span><span class="nx">block</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">block</span><span class="o">=</span><span class="k">new</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">Block</span><span class="p">;</span><span class="nx">block</span><span class="p">.</span><span class="nx">line</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">line</span><span class="p">(),</span><span class="k">this</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;indent&quot;</span><span class="p">);</span><span class="k">while</span><span class="p">(</span><span class="s2">&quot;outdent&quot;</span><span class="o">!=</span><span class="k">this</span><span class="p">.</span><span class="nx">peek</span><span class="p">().</span><span class="nx">type</span><span class="p">)</span><span class="s2">&quot;newline&quot;</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">peek</span><span class="p">().</span><span class="nx">type</span><span class="o">?</span><span class="k">this</span><span class="p">.</span><span class="nx">advance</span><span class="p">()</span><span class="o">:</span><span class="nx">block</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">parseExpr</span><span class="p">());</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;outdent&quot;</span><span class="p">),</span><span class="nx">block</span><span class="p">},</span><span class="nx">parseTag</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="s2">&quot;attrs&quot;</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">lookahead</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">type</span><span class="o">&amp;&amp;++</span><span class="nx">i</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">lookahead</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">type</span><span class="o">&amp;&amp;</span><span class="s2">&quot;indent&quot;</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">lookahead</span><span class="p">(</span><span class="o">++</span><span class="nx">i</span><span class="p">).</span><span class="nx">type</span><span class="p">)</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseASTFilter</span><span class="p">();</span><span class="kd">var</span> <span class="nx">name</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">advance</span><span class="p">().</span><span class="nx">val</span><span class="p">,</span><span class="nx">tag</span><span class="o">=</span><span class="k">new</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">Tag</span><span class="p">(</span><span class="nx">name</span><span class="p">),</span><span class="nx">dot</span><span class="p">;</span><span class="nx">tag</span><span class="p">.</span><span class="nx">line</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">line</span><span class="p">();</span><span class="nx">out</span><span class="o">:</span><span class="k">for</span><span class="p">(;;)</span><span class="k">switch</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">peek</span><span class="p">().</span><span class="nx">type</span><span class="p">){</span><span class="k">case</span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="k">case</span><span class="s2">&quot;class&quot;</span><span class="o">:</span><span class="kd">var</span> <span class="nx">tok</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">advance</span><span class="p">();</span><span class="nx">tag</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="nx">tok</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span><span class="s2">&quot;&#39;&quot;</span><span class="o">+</span><span class="nx">tok</span><span class="p">.</span><span class="nx">val</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span><span class="p">);</span><span class="k">continue</span><span class="p">;</span><span class="k">case</span><span class="s2">&quot;attrs&quot;</span><span class="o">:</span><span class="kd">var</span> <span class="nx">obj</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">advance</span><span class="p">().</span><span class="nx">attrs</span><span class="p">,</span><span class="nx">names</span><span class="o">=</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">len</span><span class="o">=</span><span class="nx">names</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span><span class="o">++</span><span class="nx">i</span><span class="p">){</span><span class="kd">var</span> <span class="nx">name</span><span class="o">=</span><span class="nx">names</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span><span class="nx">val</span><span class="o">=</span><span class="nx">obj</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span><span class="nx">tag</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="nx">val</span><span class="p">)}</span><span class="k">continue</span><span class="p">;</span><span class="k">default</span><span class="o">:</span><span class="k">break</span> <span class="nx">out</span><span class="p">}</span><span class="s2">&quot;.&quot;</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">peek</span><span class="p">().</span><span class="nx">val</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">dot</span><span class="o">=</span><span class="nx">tag</span><span class="p">.</span><span class="nx">textOnly</span><span class="o">=!</span><span class="mi">0</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">advance</span><span class="p">());</span><span class="k">switch</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">peek</span><span class="p">().</span><span class="nx">type</span><span class="p">){</span><span class="k">case</span><span class="s2">&quot;text&quot;</span><span class="o">:</span><span class="nx">tag</span><span class="p">.</span><span class="nx">text</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">parseText</span><span class="p">();</span><span class="k">break</span><span class="p">;</span><span class="k">case</span><span class="s2">&quot;code&quot;</span><span class="o">:</span><span class="nx">tag</span><span class="p">.</span><span class="nx">code</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">parseCode</span><span class="p">();</span><span class="k">break</span><span class="p">;</span><span class="k">case</span><span class="s2">&quot;:&quot;</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">advance</span><span class="p">(),</span><span class="nx">tag</span><span class="p">.</span><span class="nx">block</span><span class="o">=</span><span class="k">new</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">Block</span><span class="p">,</span><span class="nx">tag</span><span class="p">.</span><span class="nx">block</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">parseTag</span><span class="p">())}</span><span class="k">while</span><span class="p">(</span><span class="s2">&quot;newline&quot;</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">peek</span><span class="p">().</span><span class="nx">type</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">advance</span><span class="p">();</span><span class="nx">tag</span><span class="p">.</span><span class="nx">textOnly</span><span class="o">=</span><span class="nx">tag</span><span class="p">.</span><span class="nx">textOnly</span><span class="o">||~</span><span class="nx">textOnly</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">tag</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="o">==</span><span class="nx">tag</span><span class="p">.</span><span class="nx">name</span><span class="p">){</span><span class="kd">var</span> <span class="nx">type</span><span class="o">=</span><span class="nx">tag</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">);</span><span class="o">!</span><span class="nx">dot</span><span class="o">&amp;&amp;</span><span class="nx">type</span><span class="o">&amp;&amp;</span><span class="s2">&quot;text/javascript&quot;</span><span class="o">!=</span><span class="nx">type</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^[&#39;&quot;]|[&#39;&quot;]$/g</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">tag</span><span class="p">.</span><span class="nx">textOnly</span><span class="o">=!</span><span class="mi">1</span><span class="p">)}</span><span class="k">if</span><span class="p">(</span><span class="s2">&quot;indent&quot;</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">peek</span><span class="p">().</span><span class="nx">type</span><span class="p">)</span><span class="k">if</span><span class="p">(</span><span class="nx">tag</span><span class="p">.</span><span class="nx">textOnly</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">lexer</span><span class="p">.</span><span class="nx">pipeless</span><span class="o">=!</span><span class="mi">0</span><span class="p">,</span><span class="nx">tag</span><span class="p">.</span><span class="nx">block</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">parseTextBlock</span><span class="p">(),</span><span class="k">this</span><span class="p">.</span><span class="nx">lexer</span><span class="p">.</span><span class="nx">pipeless</span><span class="o">=!</span><span class="mi">1</span><span class="p">;</span><span class="k">else</span><span class="p">{</span><span class="kd">var</span> <span class="nx">block</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">block</span><span class="p">();</span><span class="k">if</span><span class="p">(</span><span class="nx">tag</span><span class="p">.</span><span class="nx">block</span><span class="p">)</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">len</span><span class="o">=</span><span class="nx">block</span><span class="p">.</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span><span class="o">++</span><span class="nx">i</span><span class="p">)</span><span class="nx">tag</span><span class="p">.</span><span class="nx">block</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span><span class="k">else</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">block</span><span class="o">=</span><span class="nx">block</span><span class="p">}</span><span class="k">return</span> <span class="nx">tag</span><span class="p">}}}),</span><span class="nx">require</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;runtime.js&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">,</span><span class="nx">require</span><span class="p">){</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="o">||</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">){</span><span class="k">return</span><span class="s2">&quot;[object Array]&quot;</span><span class="o">==</span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arr</span><span class="p">)}),</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="o">||</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">){</span><span class="kd">var</span> <span class="nx">arr</span><span class="o">=</span><span class="p">[];</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span><span class="nx">obj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="nx">arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span><span class="k">return</span> <span class="nx">arr</span><span class="p">}),</span><span class="nx">exports</span><span class="p">.</span><span class="nx">attrs</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">){</span><span class="kd">var</span> <span class="nx">buf</span><span class="o">=</span><span class="p">[],</span><span class="nx">terse</span><span class="o">=</span><span class="nx">obj</span><span class="p">.</span><span class="nx">terse</span><span class="p">;</span><span class="k">delete</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">terse</span><span class="p">;</span><span class="kd">var</span> <span class="nx">keys</span><span class="o">=</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">obj</span><span class="p">),</span><span class="nx">len</span><span class="o">=</span><span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">len</span><span class="p">){</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span><span class="o">++</span><span class="nx">i</span><span class="p">){</span><span class="kd">var</span> <span class="nx">key</span><span class="o">=</span><span class="nx">keys</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span><span class="nx">val</span><span class="o">=</span><span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span><span class="s2">&quot;boolean&quot;</span><span class="o">==</span><span class="k">typeof</span> <span class="nx">val</span><span class="o">||</span><span class="kc">null</span><span class="o">==</span><span class="nx">val</span><span class="o">?</span><span class="nx">val</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">terse</span><span class="o">?</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span><span class="o">:</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">key</span><span class="o">+</span><span class="s1">&#39;=&quot;&#39;</span><span class="o">+</span><span class="nx">key</span><span class="o">+</span><span class="s1">&#39;&quot;&#39;</span><span class="p">))</span><span class="o">:</span><span class="s2">&quot;class&quot;</span><span class="o">==</span><span class="nx">key</span><span class="o">&amp;&amp;</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span><span class="o">?</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">key</span><span class="o">+</span><span class="s1">&#39;=&quot;&#39;</span><span class="o">+</span><span class="nx">exports</span><span class="p">.</span><span class="nx">escape</span><span class="p">(</span><span class="nx">val</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">:</span><span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">key</span><span class="o">+</span><span class="s1">&#39;=&quot;&#39;</span><span class="o">+</span><span class="nx">exports</span><span class="p">.</span><span class="nx">escape</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)}}</span><span class="k">return</span> <span class="nx">buf</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)},</span><span class="nx">exports</span><span class="p">.</span><span class="nx">escape</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">){</span><span class="k">return</span> <span class="nb">String</span><span class="p">(</span><span class="nx">html</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&amp;(?!\w+;)/g</span><span class="p">,</span><span class="s2">&quot;&amp;amp;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;/g</span><span class="p">,</span><span class="s2">&quot;&amp;lt;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&gt;/g</span><span class="p">,</span><span class="s2">&quot;&amp;gt;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&quot;/g</span><span class="p">,</span><span class="s2">&quot;&amp;quot;&quot;</span><span class="p">)},</span><span class="nx">exports</span><span class="p">.</span><span class="nx">rethrow</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">filename</span><span class="p">,</span><span class="nx">lineno</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">filename</span><span class="p">)</span><span class="k">throw</span> <span class="nx">err</span><span class="p">;</span><span class="kd">var</span> <span class="nx">context</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="nx">str</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">).</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span><span class="s2">&quot;utf8&quot;</span><span class="p">),</span><span class="nx">lines</span><span class="o">=</span><span class="nx">str</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">),</span><span class="nx">start</span><span class="o">=</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">lineno</span><span class="o">-</span><span class="nx">context</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="nx">end</span><span class="o">=</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">lines</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span><span class="nx">lineno</span><span class="o">+</span><span class="nx">context</span><span class="p">),</span><span class="nx">context</span><span class="o">=</span><span class="nx">lines</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span><span class="nx">end</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">line</span><span class="p">,</span><span class="nx">i</span><span class="p">){</span><span class="kd">var</span> <span class="nx">curr</span><span class="o">=</span><span class="nx">i</span><span class="o">+</span><span class="nx">start</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="k">return</span><span class="p">(</span><span class="nx">curr</span><span class="o">==</span><span class="nx">lineno</span><span class="o">?</span><span class="s2">&quot;  &gt; &quot;</span><span class="o">:</span><span class="s2">&quot;    &quot;</span><span class="p">)</span><span class="o">+</span><span class="nx">curr</span><span class="o">+</span><span class="s2">&quot;| &quot;</span><span class="o">+</span><span class="nx">line</span><span class="p">}).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">);</span><span class="k">throw</span> <span class="nx">err</span><span class="p">.</span><span class="nx">path</span><span class="o">=</span><span class="nx">filename</span><span class="p">,</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="o">=</span><span class="p">(</span><span class="nx">filename</span><span class="o">||</span><span class="s2">&quot;Jade&quot;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="nx">lineno</span><span class="o">+</span><span class="s2">&quot;\n&quot;</span><span class="o">+</span><span class="nx">context</span><span class="o">+</span><span class="s2">&quot;\n\n&quot;</span><span class="o">+</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span><span class="nx">err</span><span class="p">}}),</span><span class="nx">require</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;self-closing.js&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">,</span><span class="nx">require</span><span class="p">){</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">,</span><span class="s2">&quot;img&quot;</span><span class="p">,</span><span class="s2">&quot;link&quot;</span><span class="p">,</span><span class="s2">&quot;input&quot;</span><span class="p">,</span><span class="s2">&quot;area&quot;</span><span class="p">,</span><span class="s2">&quot;base&quot;</span><span class="p">,</span><span class="s2">&quot;col&quot;</span><span class="p">,</span><span class="s2">&quot;br&quot;</span><span class="p">,</span><span class="s2">&quot;hr&quot;</span><span class="p">]}),</span><span class="nx">require</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;utils.js&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">,</span><span class="nx">require</span><span class="p">){</span><span class="kd">var</span> <span class="nx">interpolate</span><span class="o">=</span><span class="nx">exports</span><span class="p">.</span><span class="nx">interpolate</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">){</span><span class="k">return</span> <span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(\\)?([#!]){(.*?)}/g</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span><span class="nx">escape</span>
<span class="p">,</span><span class="nx">flag</span><span class="p">,</span><span class="nx">code</span><span class="p">){</span><span class="k">return</span> <span class="nx">escape</span><span class="o">?</span><span class="nx">str</span><span class="o">:</span><span class="s2">&quot;&#39; + &quot;</span><span class="o">+</span><span class="p">(</span><span class="s2">&quot;!&quot;</span><span class="o">==</span><span class="nx">flag</span><span class="o">?</span><span class="s2">&quot;&quot;</span><span class="o">:</span><span class="s2">&quot;escape&quot;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;((interp = &quot;</span><span class="o">+</span><span class="nx">code</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\\&#39;/g</span><span class="p">,</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;) == null ? &#39;&#39; : interp) + &#39;&quot;</span><span class="p">})},</span><span class="nx">escape</span><span class="o">=</span><span class="nx">exports</span><span class="p">.</span><span class="nx">escape</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">){</span><span class="k">return</span> <span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&#39;/g</span><span class="p">,</span><span class="s2">&quot;\\&#39;&quot;</span><span class="p">)};</span><span class="nx">exports</span><span class="p">.</span><span class="nx">text</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">){</span><span class="k">return</span> <span class="nx">interpolate</span><span class="p">(</span><span class="nx">escape</span><span class="p">(</span><span class="nx">str</span><span class="p">))}});</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Fri Jan 04 2013 21:20:43 GMT+0100 (CET)  </div></div></body></html>